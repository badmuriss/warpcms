{"version":3,"sources":["../src/assets/favicon.ts","../src/app.ts","../src/db/index.ts","../src/index.ts"],"names":["Hono","getCoreVersion","metricsMiddleware","bootstrapMiddleware","api_default","apiMediaRoutes","apiSystemRoutes","adminApiRoutes","router","adminSettingsRoutes","admin_content_default","adminLogsRoutes","userRoutes","auth_default","test_cleanup_default","d1","drizzle","schema_exports","package_default"],"mappings":"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","file":"index.cjs","sourcesContent":["/**\n * WarpCMS Favicon SVG\n *\n * Embedded SVG favicon for the admin interface and auth pages.\n * This ensures the favicon is always available without external dependencies.\n */\n\nexport const faviconSvg = `<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"no\"?>\n<svg\n   version=\"1.1\"\n   id=\"Layer_1\"\n   x=\"0px\"\n   y=\"0px\"\n   viewBox=\"380 1300 257.89001 278.8855\"\n   xml:space=\"preserve\"\n   width=\"257.89001\"\n   height=\"278.8855\"\n   xmlns=\"http://www.w3.org/2000/svg\">\n<g\n   id=\"g10\"\n   transform=\"translate(-383.935,-60.555509)\">\n\t<g\n   id=\"g9\">\n\t\t<path\n   fill=\"#f1f2f2\"\n   d=\"m 974.78,1398.211 c -5.016,6.574 -10.034,13.146 -15.048,19.721 -1.828,2.398 -3.657,4.796 -5.487,7.194 1.994,1.719 3.958,3.51 5.873,5.424 18.724,18.731 28.089,41.216 28.089,67.459 0,26.251 -9.366,48.658 -28.089,67.237 -18.731,18.579 -41.215,27.868 -67.459,27.868 -9.848,0 -19.156,-1.308 -27.923,-3.923 l -4.185,3.354 c -8.587,6.885 -17.154,13.796 -25.725,20.702 17.52,8.967 36.86,13.487 58.054,13.487 35.533,0 65.91,-12.608 91.124,-37.821 25.214,-25.215 37.821,-55.584 37.821,-91.125 0,-35.534 -12.607,-65.911 -37.821,-91.126 -3,-2.999 -6.078,-5.808 -9.224,-8.451 z\"\n   id=\"path2\" />\n\t\t<path\n   fill=\"#34d399\"\n   d=\"m 854.024,1585.195 20.001,-16.028 c 16.616,-13.507 33.04,-27.265 50.086,-40.251 1.13,-0.861 2.9,-1.686 2.003,-3.516 -0.843,-1.716 -2.481,-2.302 -4.484,-2.123 -8.514,0.765 -17.016,-0.538 -25.537,-0.353 -1.124,0.024 -2.768,0.221 -3.163,-1.25 -0.371,-1.369 1.088,-2.063 1.919,-2.894 6.26,-6.242 12.574,-12.43 18.816,-18.691 9.303,-9.327 18.565,-18.714 27.851,-28.066 1.848,-1.859 3.701,-3.713 5.549,-5.572 2.655,-2.661 5.309,-5.315 7.958,-7.982 0.574,-0.579 1.259,-1.141 1.246,-1.94 -0.004,-0.257 -0.078,-0.538 -0.254,-0.853 -0.556,-0.981 -1.441,-1.1 -2.469,-0.957 -0.658,0.096 -1.315,0.185 -1.973,0.275 -3.844,0.538 -7.689,1.076 -11.533,1.608 -3.641,0.505 -7.281,1.02 -10.922,1.529 -4.162,0.582 -8.324,1.158 -12.486,1.748 -1.142,0.161 -2.409,1.662 -3.354,0.508 -0.419,-0.508 -0.431,-1.028 -0.251,-1.531 0.269,-0.741 0.957,-1.441 1.387,-2.021 3.414,-4.58 6.882,-9.124 10.356,-13.662 1.74,-2.272 3.48,-4.544 5.214,-6.822 4.682,-6.141 9.369,-12.281 14.051,-18.422 0.09,-0.119 0.181,-0.237 0.271,-0.355 6.848,-8.98 13.7,-17.958 20.553,-26.936 0.488,-0.64 0.977,-1.28 1.465,-1.92 2.159,-2.828 4.315,-5.658 6.476,-8.486 4.197,-5.501 8.454,-10.954 12.67,-16.442 0.263,-0.347 0.538,-0.718 0.717,-1.106 0.269,-0.586 0.299,-1.196 -0.335,-1.776 -0.825,-0.753 -1.8,-0.15 -2.595,0.419 -0.67,0.472 -1.333,0.957 -1.955,1.489 -2.206,1.889 -4.401,3.797 -6.595,5.698 -3.958,3.438 -7.922,6.876 -11.976,10.194 -2.443,2.003 -4.865,4.028 -7.301,6.038 -18.689,-10.581 -39.53,-15.906 -62.549,-15.906 -35.54,0 -65.911,12.607 -91.125,37.82 -25.214,25.215 -37.821,55.592 -37.821,91.126 0,35.54 12.607,65.91 37.821,91.125 4.146,4.146 8.445,7.916 12.87,11.381 -9.015,11.14 -18.036,22.277 -27.034,33.429 -1.208,1.489 -3.755,3.151 -2.745,4.891 0.078,0.144 0.173,0.281 0.305,0.425 1.321,1.429 3.492,-1.303 4.933,-2.457 6.673,-5.333 13.333,-10.685 19.982,-16.042 3.707,-2.984 7.417,-5.965 11.124,-8.952 1.474,-1.188 2.951,-2.373 4.425,-3.561 6.41,-5.164 12.816,-10.333 19.238,-15.481 z m -56.472,-87.186 c 0,-26.243 9.29,-48.728 27.868,-67.459 18.579,-18.723 40.987,-28.089 67.238,-28.089 12.273,0 23.712,2.075 34.34,6.171 -3.37,2.905 -6.734,5.816 -10.069,8.762 -6.075,5.351 -12.365,10.469 -18.667,15.564 -4.179,3.378 -8.371,6.744 -12.514,10.164 -7.54,6.23 -15.037,12.52 -22.529,18.804 -7.091,5.955 -14.182,11.904 -21.19,17.949 -1.136,0.974 -3.055,1.907 -2.135,3.94 0.831,1.836 2.774,1.417 4.341,1.578 l 12.145,-0.599 14.151,-0.698 c 1.031,-0.102 2.192,-0.257 2.89,0.632 0.034,0.044 0.073,0.078 0.106,0.127 1.017,1.561 -0.67,2.105 -1.387,2.942 -6.308,7.318 -12.616,14.637 -18.978,21.907 -8.161,9.339 -16.353,18.649 -24.544,27.958 -2.146,2.433 -4.275,4.879 -6.422,7.312 -1.034,1.172 -2.129,2.272 -1.238,3.922 0.933,1.728 2.685,1.752 4.323,1.602 4.134,-0.367 8.263,-0.489 12.396,-0.492 0.242,0 0.485,-0.01 0.728,0 2.711,0.01 5.422,0.068 8.134,0.145 2.582,0.074 5.166,0.165 7.752,0.249 0.275,1.62 -0.879,2.356 -1.62,3.259 -1.333,1.626 -2.667,3.247 -4,4.867 -4.315,5.252 -8.62,10.514 -12.928,15.772 -3.562,-2.725 -7.007,-5.733 -10.324,-9.051 -18.577,-18.576 -27.867,-40.983 -27.867,-67.234 z\"\n   id=\"path9\" />\n\t</g>\n</g>\n</svg>`;\n","/**\n * Main Application Factory\n *\n * Creates a configured WarpCMS application with all core functionality\n */\n\nimport { Hono } from 'hono'\nimport type { Context } from 'hono'\nimport type { D1Database, KVNamespace, R2Bucket } from '@cloudflare/workers-types'\nimport {\n  apiRoutes,\n  apiMediaRoutes,\n  apiSystemRoutes,\n  adminApiRoutes,\n  authRoutes,\n  testCleanupRoutes,\n  adminContentRoutes,\n  adminUsersRoutes,\n  adminLogsRoutes,\n  adminDashboardRoutes,\n  adminSettingsRoutes,\n} from './routes'\nimport { getCoreVersion } from './utils/version'\nimport { bootstrapMiddleware } from './middleware/bootstrap'\nimport { metricsMiddleware } from './middleware/metrics'\nimport { faviconSvg } from './assets/favicon'\n\n// ============================================================================\n// Type Definitions\n// ============================================================================\n\nexport interface Bindings {\n  DB: D1Database\n  CACHE_KV: KVNamespace\n  MEDIA_BUCKET: R2Bucket\n  ASSETS: Fetcher\n  EMAIL_QUEUE?: Queue\n  SENDGRID_API_KEY?: string\n  DEFAULT_FROM_EMAIL?: string\n  IMAGES_ACCOUNT_ID?: string\n  IMAGES_API_TOKEN?: string\n  ENVIRONMENT?: string\n  BUCKET_NAME?: string\n  GOOGLE_MAPS_API_KEY?: string\n}\n\nexport interface Variables {\n  user?: {\n    userId: string\n    email: string\n    role: string\n    exp: number\n    iat: number\n  }\n  requestId?: string\n  startTime?: number\n  appVersion?: string\n}\n\nexport interface WarpCMSConfig {\n  // Custom routes\n  routes?: Array<{\n    path: string\n    handler: Hono\n  }>\n\n  // Custom middleware\n  middleware?: {\n    beforeAuth?: Array<(c: Context, next: () => Promise<void>) => Promise<void>>\n    afterAuth?: Array<(c: Context, next: () => Promise<void>) => Promise<void>>\n  }\n\n  // App metadata\n  version?: string\n  name?: string\n}\n\nexport type WarpCMSApp = Hono<{ Bindings: Bindings; Variables: Variables }>\n\n// ============================================================================\n// Application Factory\n// ============================================================================\n\n/**\n * Create a WarpCMS application with core functionality\n *\n * @param config - Application configuration\n * @returns Configured Hono application\n *\n * @example\n * ```typescript\n * import { createWarpCMSApp } from '@warpcms/core'\n *\n * const app = createWarpCMSApp({\n *   collections: {\n *     directory: './src/collections',\n *     autoSync: true\n *   },\n *   plugins: {\n *     directory: './src/plugins',\n *     autoLoad: true\n *   }\n * })\n *\n * export default app\n * ```\n */\nexport function createWarpCMSApp(config: WarpCMSConfig = {}): WarpCMSApp {\n  const app = new Hono<{ Bindings: Bindings; Variables: Variables }>()\n\n  // Set app metadata\n  const appVersion = config.version || getCoreVersion()\n  const appName = config.name || 'WarpCMS'\n\n  // App version middleware\n  app.use('*', async (c, next) => {\n    c.set('appVersion', appVersion)\n    await next()\n  })\n\n  // Metrics middleware - track all requests for real-time analytics\n  app.use('*', metricsMiddleware())\n\n  // Bootstrap middleware - runs migrations, syncs collections, and initializes plugins\n  app.use('*', bootstrapMiddleware(config))\n\n  // Custom middleware - before auth\n  if (config.middleware?.beforeAuth) {\n    for (const middleware of config.middleware.beforeAuth) {\n      app.use('*', middleware)\n    }\n  }\n\n  // Logging middleware\n  app.use('*', async (_c, next) => {\n    // Logging logic here\n    await next()\n  })\n\n  // Security middleware\n  app.use('*', async (_c, next) => {\n    // Security headers, CORS, etc.\n    await next()\n  })\n\n  // Custom middleware - after auth\n  if (config.middleware?.afterAuth) {\n    for (const middleware of config.middleware.afterAuth) {\n      app.use('*', middleware)\n    }\n  }\n\n  // Serve uploaded media files from R2 (public, no auth required)\n  app.get('/api/media/file/*', async (c) => {\n    try {\n      if (!c.env.MEDIA_BUCKET) {\n        return c.json({ error: 'R2 storage is not configured' }, 503)\n      }\n\n      const url = new URL(c.req.url)\n      const r2Key = url.pathname.replace(/^\\/api\\/media\\/file\\//, '')\n\n      if (!r2Key) {\n        return c.notFound()\n      }\n\n      const object = await c.env.MEDIA_BUCKET.get(r2Key)\n\n      if (!object) {\n        return c.notFound()\n      }\n\n      const headers = new Headers()\n      object.httpMetadata?.contentType && headers.set('Content-Type', object.httpMetadata.contentType)\n      object.httpMetadata?.contentDisposition && headers.set('Content-Disposition', object.httpMetadata.contentDisposition)\n      headers.set('Cache-Control', 'public, max-age=31536000')\n      headers.set('Access-Control-Allow-Origin', '*')\n\n      return new Response(object.body as any, { headers })\n    } catch (error) {\n      console.error('Error serving media file:', error)\n      return c.json({ error: 'Failed to serve file' }, 500)\n    }\n  })\n\n  // Core routes\n  // Routes are being imported incrementally from routes/*\n  // Each route is tested and migrated one-by-one\n  app.route('/api', apiRoutes)\n  app.route('/api/media', apiMediaRoutes)\n  app.route('/api/system', apiSystemRoutes)\n  app.route('/admin/api', adminApiRoutes)\n  app.route('/admin/dashboard', adminDashboardRoutes)\n  app.route('/admin/settings', adminSettingsRoutes)\n  app.route('/admin/content', adminContentRoutes)\n  app.route('/admin/logs', adminLogsRoutes)\n  app.route('/admin', adminUsersRoutes)\n  app.route('/auth', authRoutes)\n\n  // Test cleanup routes (only for development/test environments)\n  app.route('/', testCleanupRoutes)\n\n  // Serve favicon\n  app.get('/favicon.svg', (c) => {\n    return new Response(faviconSvg, {\n      headers: {\n        'Content-Type': 'image/svg+xml',\n        'Cache-Control': 'public, max-age=31536000'\n      }\n    })\n  })\n\n  // Serve files from R2 storage (public file access)\n  app.get('/files/*', async (c) => {\n    try {\n      // Extract the path from the URL pathname (everything after /files/)\n      const url = new URL(c.req.url)\n      const pathname = url.pathname\n\n      // Remove the /files/ prefix to get the R2 object key\n      const objectKey = pathname.replace(/^\\/files\\//, '')\n\n      if (!objectKey) {\n        return c.notFound()\n      }\n\n      // Get file from R2\n      const object = await c.env.MEDIA_BUCKET.get(objectKey)\n\n      if (!object) {\n        return c.notFound()\n      }\n\n      // Set appropriate headers\n      const headers = new Headers()\n      object.httpMetadata?.contentType && headers.set('Content-Type', object.httpMetadata.contentType)\n      object.httpMetadata?.contentDisposition && headers.set('Content-Disposition', object.httpMetadata.contentDisposition)\n      headers.set('Cache-Control', 'public, max-age=31536000') // 1 year cache\n      headers.set('Access-Control-Allow-Origin', '*') // Allow CORS for media files\n      headers.set('Access-Control-Allow-Methods', 'GET, HEAD, OPTIONS')\n      headers.set('Access-Control-Allow-Headers', 'Content-Type')\n\n      return new Response(object.body as any, {\n        headers\n      })\n    } catch (error) {\n      console.error('Error serving file:', error)\n      return c.notFound()\n    }\n  })\n\n  // Custom routes - User-defined routes\n  if (config.routes) {\n    for (const route of config.routes) {\n      app.route(route.path, route.handler)\n    }\n  }\n\n  // Root redirect to login\n  app.get('/', (c) => {\n    return c.redirect('/auth/login')\n  })\n\n  // Health check\n  app.get('/health', (c) => {\n    return c.json({\n      name: appName,\n      version: appVersion,\n      status: 'running',\n      timestamp: new Date().toISOString()\n    })\n  })\n\n  // 404 handler\n  app.notFound((c) => {\n    return c.json({ error: 'Not Found', status: 404 }, 404)\n  })\n\n  // Error handler\n  app.onError((err, c) => {\n    console.error(err)\n    return c.json({ error: 'Internal Server Error', status: 500 }, 500)\n  })\n\n  return app\n}","import { drizzle } from 'drizzle-orm/d1';\nimport * as schema from './schema';\n\nexport function createDb(d1: D1Database) {\n  return drizzle(d1, { schema });\n}\n\nexport * from './schema';","/**\n * @warpcms/core - Main Entry Point\n *\n * Core framework for WarpCMS headless CMS\n * Built for Cloudflare's edge platform with TypeScript\n *\n * Phase 2 Migration Status:\n * - Week 1: Types, Utils, Database (COMPLETED ✓)\n * - Week 2: Services, Middleware, Plugins (COMPLETED ✓)\n * - Week 3: Routes, Templates (COMPLETED ✓)\n * - Week 4: Integration & Testing (COMPLETED ✓)\n *\n * Test Coverage:\n * - Utilities: 48 tests (sanitize, query-filter, metrics)\n * - Middleware: 51 tests (auth, logging, security, performance)\n * - Total: 99 tests passing\n */\n\n// ============================================================================\n// Main Application API (Phase 2 Week 1)\n// ============================================================================\n\nexport { createWarpCMSApp } from './app'\nexport type { WarpCMSConfig, WarpCMSApp, Bindings, Variables } from './app'\n\n// ============================================================================\n// Placeholders - To be populated in Phase 2\n// ============================================================================\n\n// Services - Week 2 (COMPLETED)\nexport {\n  // Database Migrations\n  MigrationService,\n  // Logging\n  Logger,\n  getLogger,\n  initLogger,\n  // Plugin Services - Class implementations\n  PluginService as PluginServiceClass,\n  PluginBootstrapService,\n} from './services'\n\nexport type { Migration, MigrationStatus, LogLevel, LogCategory, LogEntry, LogFilter, CorePlugin } from './services'\n\n// Middleware - Week 2 (COMPLETED)\nexport {\n  // Authentication\n  AuthManager,\n  requireAuth,\n  requireRole,\n  optionalAuth,\n  // Logging\n  loggingMiddleware,\n  detailedLoggingMiddleware,\n  securityLoggingMiddleware,\n  performanceLoggingMiddleware,\n  // Performance\n  cacheHeaders,\n  compressionMiddleware,\n  securityHeaders,\n  // Permissions\n  PermissionManager,\n  requirePermission,\n  requireAnyPermission,\n  logActivity,\n  // Plugin middleware\n  requireActivePlugin,\n  requireActivePlugins,\n  getActivePlugins,\n  isPluginActive,\n  // Bootstrap\n  bootstrapMiddleware,\n} from './middleware'\n\nexport type { Permission, UserPermissions } from './middleware'\n\n// Plugins - Week 2 (COMPLETED)\nexport {\n  // Hook System - Class implementations\n  HookSystemImpl,\n  ScopedHookSystem as ScopedHookSystemClass,\n  HookUtils,\n  // Plugin Registry\n  PluginRegistryImpl,\n  // Plugin Manager - Class implementation\n  PluginManager as PluginManagerClass,\n  // Plugin Validator - Class implementation\n  PluginValidator as PluginValidatorClass,\n} from './plugins'\n\n// Routes - Week 3 (COMPLETED)\nexport {\n  ROUTES_INFO,\n  apiRoutes,\n  apiContentCrudRoutes,\n  apiMediaRoutes,\n  apiSystemRoutes,\n  adminApiRoutes,\n  authRoutes,\n  adminContentRoutes,\n  adminUsersRoutes,\n  adminLogsRoutes,\n  adminDashboardRoutes,\n  adminSettingsRoutes,\n} from './routes'\n\n// Templates - Week 3 (COMPLETED)\nexport {\n  renderAdminLayout,\n  renderAdminLayoutCatalyst,\n  renderLogo,\n  renderAlert,\n  renderConfirmationDialog,\n  getConfirmationDialogScript,\n  renderTable,\n  renderPagination,\n  renderFilterBar,\n} from './templates'\nexport type {\n  AdminLayoutData,\n  AdminLayoutCatalystData,\n  AlertData,\n  ConfirmationDialogOptions,\n  TableColumn,\n  TableData,\n  PaginationData,\n  FilterBarData,\n  Filter,\n  FilterOption,\n} from './templates'\n\n// Types - Week 1 (COMPLETED)\nexport type {\n  // Collection types\n  FieldType,\n  FieldConfig,\n  CollectionSchema,\n  CollectionConfig,\n  CollectionConfigModule,\n  CollectionSyncResult,\n  // Plugin types\n  Plugin,\n  PluginContext,\n  PluginConfig,\n  PluginRoutes,\n  PluginMiddleware,\n  PluginModel,\n  PluginService,\n  PluginAdminPage,\n  PluginComponent,\n  PluginMenuItem,\n  PluginHook,\n  HookHandler,\n  HookContext,\n  HookSystem,\n  ScopedHookSystem,\n  PluginRegistry,\n  PluginManager,\n  PluginStatus,\n  AuthService,\n  ContentService,\n  MediaService,\n  PluginLogger,\n  PluginBuilderOptions,\n  PluginValidator,\n  PluginValidationResult,\n  HookName,\n  // Plugin manifest\n  PluginManifest,\n} from './types'\n\nexport { HOOKS } from './types'\n\n// Utils - Week 1 (COMPLETED)\nexport {\n  // Sanitization\n  escapeHtml,\n  sanitizeInput,\n  sanitizeObject,\n  // Template rendering\n  TemplateRenderer,\n  templateRenderer,\n  renderTemplate,\n  // Query filtering\n  QueryFilterBuilder,\n  buildQuery,\n  // Metrics\n  metricsTracker,\n  // Version\n  WARPJS_VERSION,\n  SONICJS_VERSION,\n  getWarpCMSVersion,\n  getCoreVersion,\n} from './utils'\n\nexport type {\n  FilterOperator,\n  FilterCondition,\n  FilterGroup,\n  QueryFilter,\n  QueryResult,\n} from './utils'\n\n// Database - Week 1 (COMPLETED)\nexport {\n  createDb,\n  // Schema exports\n  users,\n  collections,\n  content,\n  contentVersions,\n  media,\n  apiTokens,\n  plugins,\n  pluginHooks,\n  pluginRoutes,\n  pluginAssets,\n  pluginActivityLog,\n  systemLogs,\n  logConfig,\n  // Zod validation schemas\n  insertUserSchema,\n  selectUserSchema,\n  insertCollectionSchema,\n  selectCollectionSchema,\n  insertContentSchema,\n  selectContentSchema,\n  insertMediaSchema,\n  selectMediaSchema,\n  insertPluginSchema,\n  selectPluginSchema,\n  insertPluginHookSchema,\n  selectPluginHookSchema,\n  insertPluginRouteSchema,\n  selectPluginRouteSchema,\n  insertPluginAssetSchema,\n  selectPluginAssetSchema,\n  insertPluginActivityLogSchema,\n  selectPluginActivityLogSchema,\n  insertSystemLogSchema,\n  selectSystemLogSchema,\n  insertLogConfigSchema,\n  selectLogConfigSchema,\n} from './db'\n\nexport type {\n  User,\n  NewUser,\n  Collection,\n  NewCollection,\n  Content,\n  NewContent,\n  Media,\n  NewMedia,\n  Plugin as DbPlugin,\n  NewPlugin,\n  PluginHook as DbPluginHook,\n  NewPluginHook,\n  PluginRoute,\n  NewPluginRoute,\n  PluginAsset,\n  NewPluginAsset,\n  PluginActivityLog,\n  NewPluginActivityLog,\n  SystemLog,\n  NewSystemLog,\n  LogConfig,\n  NewLogConfig,\n} from './db'\n\n// ============================================================================\n// Version\n// ============================================================================\n\n// Import version from package.json\nimport packageJson from '../package.json'\nexport const VERSION = packageJson.version\n\n// ============================================================================\n// Phase 2 Migration Notes\n// ============================================================================\n\n/**\n * This is a work-in-progress package being extracted from the main WarpCMS codebase.\n *\n * Current Phase: 2 (Core Module Migration)\n * Current Week: 1 (Types, Utils, Database)\n *\n * Expected completion: 4 weeks from 2025-01-17\n *\n * DO NOT USE IN PRODUCTION - Alpha release for development only\n */\n"]}