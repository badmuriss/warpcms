/**
 * AUTO-GENERATED FILE - DO NOT EDIT
 * Generated by: scripts/generate-migrations.ts
 * Generated at: 2026-02-27T03:51:55.934Z
 *
 * This file contains all migration SQL bundled for use in Cloudflare Workers
 * where filesystem access is not available at runtime.
 */

export interface BundledMigration {
  id: string
  name: string
  filename: string
  description: string
  sql: string
}

export const bundledMigrations: BundledMigration[] = [
  {
    id: '0001',
    name: 'Initial Schema',
    filename: '0001_initial_schema.sql',
    description: 'Migration 0001: Initial Schema',
    sql: "-- =============================================================================\n-- WarpCMS AI - Consolidated Initial Schema Migration\n-- =============================================================================\n-- Combines migrations 001-031 into a single clean schema.\n-- All tables use CREATE TABLE IF NOT EXISTS with final column definitions.\n-- All seed data uses INSERT OR IGNORE for idempotency.\n-- =============================================================================\n\nPRAGMA foreign_keys = ON;\n\n-- =============================================================================\n-- SECTION 1: CORE TABLES (Users, Collections, Content, Media, API Tokens)\n-- =============================================================================\n\n-- Users table with full profile, preferences, and auth columns\nCREATE TABLE IF NOT EXISTS users (\n  id TEXT PRIMARY KEY,\n  email TEXT NOT NULL UNIQUE,\n  username TEXT NOT NULL UNIQUE,\n  first_name TEXT NOT NULL,\n  last_name TEXT NOT NULL,\n  password_hash TEXT,\n  role TEXT NOT NULL DEFAULT 'viewer',\n  avatar TEXT,\n  is_active INTEGER NOT NULL DEFAULT 1,\n  last_login_at INTEGER,\n  created_at INTEGER NOT NULL,\n  updated_at INTEGER NOT NULL,\n  -- Profile fields (migration 004)\n  phone TEXT,\n  bio TEXT,\n  avatar_url TEXT,\n  timezone TEXT DEFAULT 'UTC',\n  language TEXT DEFAULT 'en',\n  email_notifications INTEGER DEFAULT 1,\n  theme TEXT DEFAULT 'dark',\n  -- Two-factor authentication\n  two_factor_enabled INTEGER DEFAULT 0,\n  two_factor_secret TEXT,\n  -- Password reset\n  password_reset_token TEXT,\n  password_reset_expires INTEGER,\n  -- Email verification\n  email_verified INTEGER DEFAULT 0,\n  email_verification_token TEXT,\n  -- Invitation system\n  invitation_token TEXT,\n  invited_by TEXT REFERENCES users(id),\n  invited_at INTEGER,\n  accepted_invitation_at INTEGER\n);\n\n-- Collections table for content schema definitions\nCREATE TABLE IF NOT EXISTS collections (\n  id TEXT PRIMARY KEY,\n  name TEXT NOT NULL UNIQUE,\n  display_name TEXT NOT NULL,\n  description TEXT,\n  schema TEXT NOT NULL, -- JSON schema definition\n  is_active INTEGER NOT NULL DEFAULT 1,\n  managed INTEGER NOT NULL DEFAULT 0, -- migration 011: config-managed collections\n  created_at INTEGER NOT NULL,\n  updated_at INTEGER NOT NULL\n);\n\n-- Content table with scheduling, workflow, review, and metadata columns\nCREATE TABLE IF NOT EXISTS content (\n  id TEXT PRIMARY KEY,\n  collection_id TEXT NOT NULL, -- content type name (image, text, file)\n  slug TEXT NOT NULL,\n  title TEXT NOT NULL,\n  data TEXT NOT NULL, -- JSON content data\n  status TEXT NOT NULL DEFAULT 'draft',\n  published_at INTEGER,\n  author_id TEXT NOT NULL REFERENCES users(id),\n  created_at INTEGER NOT NULL,\n  updated_at INTEGER NOT NULL,\n  -- Scheduling (migration 003)\n  scheduled_publish_at INTEGER,\n  scheduled_unpublish_at INTEGER,\n  -- Review workflow (migration 003)\n  review_status TEXT DEFAULT 'none',\n  reviewer_id TEXT REFERENCES users(id),\n  reviewed_at INTEGER,\n  review_notes TEXT,\n  -- Content metadata (migration 003)\n  meta_title TEXT,\n  meta_description TEXT,\n  featured_image_id TEXT REFERENCES media(id),\n  content_type TEXT DEFAULT 'standard',\n  -- Workflow & automation (migration 005)\n  workflow_state_id TEXT DEFAULT 'draft',\n  embargo_until DATETIME,\n  expires_at DATETIME,\n  version_number INTEGER DEFAULT 1,\n  is_auto_saved INTEGER DEFAULT 0\n);\n\n-- Content versions table (Drizzle schema definition)\nCREATE TABLE IF NOT EXISTS content_versions (\n  id TEXT PRIMARY KEY,\n  content_id TEXT NOT NULL REFERENCES content(id),\n  version INTEGER NOT NULL,\n  data TEXT NOT NULL, -- JSON data\n  author_id TEXT NOT NULL REFERENCES users(id),\n  created_at INTEGER NOT NULL\n);\n\n-- Media/files table with R2 integration\nCREATE TABLE IF NOT EXISTS media (\n  id TEXT PRIMARY KEY,\n  filename TEXT NOT NULL,\n  original_name TEXT NOT NULL,\n  mime_type TEXT NOT NULL,\n  size INTEGER NOT NULL,\n  width INTEGER,\n  height INTEGER,\n  folder TEXT NOT NULL DEFAULT 'uploads',\n  r2_key TEXT NOT NULL,\n  public_url TEXT NOT NULL,\n  thumbnail_url TEXT,\n  alt TEXT,\n  caption TEXT,\n  tags TEXT, -- JSON array of tags\n  uploaded_by TEXT NOT NULL REFERENCES users(id),\n  uploaded_at INTEGER NOT NULL,\n  updated_at INTEGER,\n  published_at INTEGER,\n  scheduled_at INTEGER,\n  archived_at INTEGER,\n  deleted_at INTEGER\n);\n\n-- API tokens table for programmatic access\nCREATE TABLE IF NOT EXISTS api_tokens (\n  id TEXT PRIMARY KEY,\n  name TEXT NOT NULL,\n  token TEXT NOT NULL UNIQUE,\n  user_id TEXT NOT NULL REFERENCES users(id),\n  permissions TEXT NOT NULL, -- JSON array of permissions\n  expires_at INTEGER,\n  last_used_at INTEGER,\n  created_at INTEGER NOT NULL\n);\n\n-- Workflow history table for content workflow tracking\nCREATE TABLE IF NOT EXISTS workflow_history (\n  id TEXT PRIMARY KEY,\n  content_id TEXT NOT NULL REFERENCES content(id),\n  action TEXT NOT NULL,\n  from_status TEXT NOT NULL,\n  to_status TEXT NOT NULL,\n  user_id TEXT NOT NULL REFERENCES users(id),\n  comment TEXT,\n  created_at INTEGER NOT NULL\n);\n\n-- =============================================================================\n-- SECTION 2: CONTENT MANAGEMENT EXTENSIONS (Fields, Relationships, Templates)\n-- =============================================================================\n\n-- Dynamic field definitions for collections\nCREATE TABLE IF NOT EXISTS content_fields (\n  id TEXT PRIMARY KEY,\n  collection_id TEXT NOT NULL REFERENCES collections(id),\n  field_name TEXT NOT NULL,\n  field_type TEXT NOT NULL, -- text, richtext, number, boolean, date, select, media, relationship, slug\n  field_label TEXT NOT NULL,\n  field_options TEXT, -- JSON for select options, validation rules, etc.\n  field_order INTEGER NOT NULL DEFAULT 0,\n  is_required INTEGER NOT NULL DEFAULT 0,\n  is_searchable INTEGER NOT NULL DEFAULT 0,\n  created_at INTEGER NOT NULL,\n  updated_at INTEGER NOT NULL,\n  UNIQUE(collection_id, field_name)\n);\n\n-- Content relationships\nCREATE TABLE IF NOT EXISTS content_relationships (\n  id TEXT PRIMARY KEY,\n  source_content_id TEXT NOT NULL REFERENCES content(id),\n  target_content_id TEXT NOT NULL REFERENCES content(id),\n  relationship_type TEXT NOT NULL,\n  created_at INTEGER NOT NULL,\n  UNIQUE(source_content_id, target_content_id, relationship_type)\n);\n\n-- Reusable workflow templates\nCREATE TABLE IF NOT EXISTS workflow_templates (\n  id TEXT PRIMARY KEY,\n  name TEXT NOT NULL,\n  description TEXT,\n  collection_id TEXT REFERENCES collections(id),\n  workflow_steps TEXT NOT NULL, -- JSON array of workflow steps\n  is_active INTEGER NOT NULL DEFAULT 1,\n  created_at INTEGER NOT NULL,\n  updated_at INTEGER NOT NULL\n);\n\n-- =============================================================================\n-- SECTION 3: USER MANAGEMENT & PERMISSIONS\n-- =============================================================================\n\n-- Teams for team-based collaboration\nCREATE TABLE IF NOT EXISTS teams (\n  id TEXT PRIMARY KEY,\n  name TEXT NOT NULL,\n  description TEXT,\n  slug TEXT NOT NULL UNIQUE,\n  owner_id TEXT NOT NULL REFERENCES users(id),\n  settings TEXT, -- JSON for team settings\n  is_active INTEGER NOT NULL DEFAULT 1,\n  created_at INTEGER NOT NULL,\n  updated_at INTEGER NOT NULL\n);\n\n-- Team memberships\nCREATE TABLE IF NOT EXISTS team_memberships (\n  id TEXT PRIMARY KEY,\n  team_id TEXT NOT NULL REFERENCES teams(id) ON DELETE CASCADE,\n  user_id TEXT NOT NULL REFERENCES users(id) ON DELETE CASCADE,\n  role TEXT NOT NULL DEFAULT 'member',\n  permissions TEXT, -- JSON for specific permissions\n  joined_at INTEGER NOT NULL,\n  updated_at INTEGER NOT NULL,\n  UNIQUE(team_id, user_id)\n);\n\n-- Granular permissions\nCREATE TABLE IF NOT EXISTS permissions (\n  id TEXT PRIMARY KEY,\n  name TEXT NOT NULL UNIQUE,\n  description TEXT,\n  category TEXT NOT NULL,\n  created_at INTEGER NOT NULL\n);\n\n-- Role-permission mappings\nCREATE TABLE IF NOT EXISTS role_permissions (\n  id TEXT PRIMARY KEY,\n  role TEXT NOT NULL,\n  permission_id TEXT NOT NULL REFERENCES permissions(id),\n  created_at INTEGER NOT NULL,\n  UNIQUE(role, permission_id)\n);\n\n-- User sessions for session management\nCREATE TABLE IF NOT EXISTS user_sessions (\n  id TEXT PRIMARY KEY,\n  user_id TEXT NOT NULL REFERENCES users(id) ON DELETE CASCADE,\n  token_hash TEXT NOT NULL,\n  ip_address TEXT,\n  user_agent TEXT,\n  is_active INTEGER NOT NULL DEFAULT 1,\n  expires_at INTEGER NOT NULL,\n  created_at INTEGER NOT NULL,\n  last_used_at INTEGER\n);\n\n-- Activity log for audit trails\nCREATE TABLE IF NOT EXISTS activity_logs (\n  id TEXT PRIMARY KEY,\n  user_id TEXT REFERENCES users(id),\n  action TEXT NOT NULL,\n  resource_type TEXT,\n  resource_id TEXT,\n  details TEXT, -- JSON with additional details\n  ip_address TEXT,\n  user_agent TEXT,\n  created_at INTEGER NOT NULL\n);\n\n-- Password history for security\nCREATE TABLE IF NOT EXISTS password_history (\n  id TEXT PRIMARY KEY,\n  user_id TEXT NOT NULL REFERENCES users(id) ON DELETE CASCADE,\n  password_hash TEXT NOT NULL,\n  created_at INTEGER NOT NULL\n);\n\n-- =============================================================================\n-- SECTION 4: WORKFLOW & AUTOMATION SYSTEM\n-- =============================================================================\n\n-- Workflow states\nCREATE TABLE IF NOT EXISTS workflow_states (\n  id TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))),\n  name TEXT NOT NULL,\n  description TEXT,\n  color TEXT DEFAULT '#6B7280',\n  is_initial INTEGER DEFAULT 0,\n  is_final INTEGER DEFAULT 0,\n  created_at DATETIME DEFAULT CURRENT_TIMESTAMP\n);\n\n-- Workflows\nCREATE TABLE IF NOT EXISTS workflows (\n  id TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))),\n  name TEXT NOT NULL,\n  description TEXT,\n  collection_id TEXT REFERENCES collections(id) ON DELETE CASCADE,\n  is_active INTEGER DEFAULT 1,\n  auto_publish INTEGER DEFAULT 0,\n  require_approval INTEGER DEFAULT 1,\n  approval_levels INTEGER DEFAULT 1,\n  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP\n);\n\n-- Workflow transitions\nCREATE TABLE IF NOT EXISTS workflow_transitions (\n  id TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))),\n  workflow_id TEXT NOT NULL REFERENCES workflows(id) ON DELETE CASCADE,\n  from_state_id TEXT NOT NULL REFERENCES workflow_states(id),\n  to_state_id TEXT NOT NULL REFERENCES workflow_states(id),\n  required_permission TEXT,\n  auto_transition INTEGER DEFAULT 0,\n  transition_conditions TEXT, -- JSON\n  created_at DATETIME DEFAULT CURRENT_TIMESTAMP\n);\n\n-- Content workflow status tracking\nCREATE TABLE IF NOT EXISTS content_workflow_status (\n  id TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))),\n  content_id TEXT NOT NULL REFERENCES content(id) ON DELETE CASCADE,\n  workflow_id TEXT NOT NULL REFERENCES workflows(id),\n  current_state_id TEXT NOT NULL REFERENCES workflow_states(id),\n  assigned_to TEXT REFERENCES users(id),\n  due_date DATETIME,\n  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n  UNIQUE(content_id, workflow_id)\n);\n\n-- Scheduled content actions\nCREATE TABLE IF NOT EXISTS scheduled_content (\n  id TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))),\n  content_id TEXT NOT NULL REFERENCES content(id) ON DELETE CASCADE,\n  action TEXT NOT NULL,\n  scheduled_at DATETIME NOT NULL,\n  timezone TEXT DEFAULT 'UTC',\n  user_id TEXT NOT NULL REFERENCES users(id),\n  status TEXT DEFAULT 'pending',\n  executed_at DATETIME,\n  error_message TEXT,\n  created_at DATETIME DEFAULT CURRENT_TIMESTAMP\n);\n\n-- Notifications\nCREATE TABLE IF NOT EXISTS notifications (\n  id TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))),\n  user_id TEXT NOT NULL REFERENCES users(id) ON DELETE CASCADE,\n  type TEXT NOT NULL,\n  title TEXT NOT NULL,\n  message TEXT NOT NULL,\n  data TEXT, -- JSON\n  is_read INTEGER DEFAULT 0,\n  created_at DATETIME DEFAULT CURRENT_TIMESTAMP\n);\n\n-- Notification preferences\nCREATE TABLE IF NOT EXISTS notification_preferences (\n  id TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))),\n  user_id TEXT NOT NULL REFERENCES users(id) ON DELETE CASCADE,\n  notification_type TEXT NOT NULL,\n  email_enabled INTEGER DEFAULT 1,\n  in_app_enabled INTEGER DEFAULT 1,\n  digest_frequency TEXT DEFAULT 'daily',\n  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n  UNIQUE(user_id, notification_type)\n);\n\n-- Webhooks\nCREATE TABLE IF NOT EXISTS webhooks (\n  id TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))),\n  name TEXT NOT NULL,\n  url TEXT NOT NULL,\n  secret TEXT,\n  events TEXT NOT NULL, -- JSON array of event types\n  is_active INTEGER DEFAULT 1,\n  retry_count INTEGER DEFAULT 3,\n  timeout_seconds INTEGER DEFAULT 30,\n  last_success_at DATETIME,\n  last_failure_at DATETIME,\n  failure_count INTEGER DEFAULT 0,\n  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP\n);\n\n-- Webhook delivery log\nCREATE TABLE IF NOT EXISTS webhook_deliveries (\n  id TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))),\n  webhook_id TEXT NOT NULL REFERENCES webhooks(id) ON DELETE CASCADE,\n  event_type TEXT NOT NULL,\n  payload TEXT NOT NULL, -- JSON\n  response_status INTEGER,\n  response_body TEXT,\n  attempt_count INTEGER DEFAULT 1,\n  delivered_at DATETIME DEFAULT CURRENT_TIMESTAMP\n);\n\n-- Automation rules\nCREATE TABLE IF NOT EXISTS automation_rules (\n  id TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))),\n  name TEXT NOT NULL,\n  description TEXT,\n  trigger_type TEXT NOT NULL,\n  trigger_conditions TEXT, -- JSON\n  action_type TEXT NOT NULL,\n  action_config TEXT, -- JSON\n  is_active INTEGER DEFAULT 1,\n  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP\n);\n\n-- Auto-save drafts\nCREATE TABLE IF NOT EXISTS auto_save_drafts (\n  id TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))),\n  content_id TEXT REFERENCES content(id) ON DELETE CASCADE,\n  user_id TEXT NOT NULL REFERENCES users(id),\n  title TEXT,\n  content TEXT,\n  fields TEXT, -- JSON\n  last_saved_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n  UNIQUE(content_id, user_id)\n);\n\n-- =============================================================================\n-- SECTION 5: PLUGIN SYSTEM\n-- =============================================================================\n\n-- Plugins registry\nCREATE TABLE IF NOT EXISTS plugins (\n  id TEXT PRIMARY KEY,\n  name TEXT NOT NULL UNIQUE,\n  display_name TEXT NOT NULL,\n  description TEXT,\n  version TEXT NOT NULL,\n  author TEXT NOT NULL,\n  category TEXT NOT NULL,\n  icon TEXT,\n  status TEXT DEFAULT 'inactive' CHECK (status IN ('active', 'inactive', 'error')),\n  is_core BOOLEAN DEFAULT FALSE,\n  settings JSON,\n  permissions JSON,\n  dependencies JSON,\n  download_count INTEGER DEFAULT 0,\n  rating REAL DEFAULT 0,\n  installed_at INTEGER NOT NULL,\n  activated_at INTEGER,\n  last_updated INTEGER NOT NULL,\n  error_message TEXT,\n  created_at INTEGER DEFAULT (unixepoch()),\n  updated_at INTEGER DEFAULT (unixepoch())\n);\n\n-- Plugin hooks\nCREATE TABLE IF NOT EXISTS plugin_hooks (\n  id TEXT PRIMARY KEY,\n  plugin_id TEXT NOT NULL,\n  hook_name TEXT NOT NULL,\n  handler_name TEXT NOT NULL,\n  priority INTEGER DEFAULT 10,\n  is_active BOOLEAN DEFAULT TRUE,\n  created_at INTEGER DEFAULT (unixepoch()),\n  FOREIGN KEY (plugin_id) REFERENCES plugins(id) ON DELETE CASCADE,\n  UNIQUE(plugin_id, hook_name, handler_name)\n);\n\n-- Plugin routes\nCREATE TABLE IF NOT EXISTS plugin_routes (\n  id TEXT PRIMARY KEY,\n  plugin_id TEXT NOT NULL,\n  path TEXT NOT NULL,\n  method TEXT NOT NULL,\n  handler_name TEXT NOT NULL,\n  middleware JSON,\n  is_active BOOLEAN DEFAULT TRUE,\n  created_at INTEGER DEFAULT (unixepoch()),\n  FOREIGN KEY (plugin_id) REFERENCES plugins(id) ON DELETE CASCADE,\n  UNIQUE(plugin_id, path, method)\n);\n\n-- Plugin assets (CSS, JS files)\nCREATE TABLE IF NOT EXISTS plugin_assets (\n  id TEXT PRIMARY KEY,\n  plugin_id TEXT NOT NULL,\n  asset_type TEXT NOT NULL CHECK (asset_type IN ('css', 'js', 'image', 'font')),\n  asset_path TEXT NOT NULL,\n  load_order INTEGER DEFAULT 100,\n  load_location TEXT DEFAULT 'footer' CHECK (load_location IN ('header', 'footer')),\n  is_active BOOLEAN DEFAULT TRUE,\n  created_at INTEGER DEFAULT (unixepoch()),\n  FOREIGN KEY (plugin_id) REFERENCES plugins(id) ON DELETE CASCADE\n);\n\n-- Plugin activity log\nCREATE TABLE IF NOT EXISTS plugin_activity_log (\n  id TEXT PRIMARY KEY,\n  plugin_id TEXT NOT NULL,\n  action TEXT NOT NULL,\n  user_id TEXT,\n  details JSON,\n  timestamp INTEGER DEFAULT (unixepoch()),\n  FOREIGN KEY (plugin_id) REFERENCES plugins(id) ON DELETE CASCADE\n);\n\n-- =============================================================================\n-- SECTION 6: STANDALONE PLUGIN TABLES (FAQs, Testimonials, Code Examples)\n-- =============================================================================\n\n-- FAQ table (table structure only, no sample data)\nCREATE TABLE IF NOT EXISTS faqs (\n  id INTEGER PRIMARY KEY AUTOINCREMENT,\n  question TEXT NOT NULL,\n  answer TEXT NOT NULL,\n  category TEXT,\n  tags TEXT,\n  isPublished INTEGER NOT NULL DEFAULT 1,\n  sortOrder INTEGER NOT NULL DEFAULT 0,\n  created_at INTEGER NOT NULL DEFAULT (strftime('%s', 'now')),\n  updated_at INTEGER NOT NULL DEFAULT (strftime('%s', 'now'))\n);\n\n-- Testimonials table (table structure only, no sample data)\nCREATE TABLE IF NOT EXISTS testimonials (\n  id INTEGER PRIMARY KEY AUTOINCREMENT,\n  author_name TEXT NOT NULL,\n  author_title TEXT,\n  author_company TEXT,\n  testimonial_text TEXT NOT NULL,\n  rating INTEGER CHECK(rating >= 1 AND rating <= 5),\n  isPublished INTEGER NOT NULL DEFAULT 1,\n  sortOrder INTEGER NOT NULL DEFAULT 0,\n  created_at INTEGER NOT NULL DEFAULT (strftime('%s', 'now')),\n  updated_at INTEGER NOT NULL DEFAULT (strftime('%s', 'now'))\n);\n\n-- Code examples table (table structure only, no sample data)\nCREATE TABLE IF NOT EXISTS code_examples (\n  id INTEGER PRIMARY KEY AUTOINCREMENT,\n  title TEXT NOT NULL,\n  description TEXT,\n  code TEXT NOT NULL,\n  language TEXT NOT NULL,\n  category TEXT,\n  tags TEXT,\n  isPublished INTEGER NOT NULL DEFAULT 1,\n  sortOrder INTEGER NOT NULL DEFAULT 0,\n  created_at INTEGER NOT NULL DEFAULT (strftime('%s', 'now')),\n  updated_at INTEGER NOT NULL DEFAULT (strftime('%s', 'now'))\n);\n\n-- =============================================================================\n-- SECTION 7: SYSTEM LOGGING\n-- =============================================================================\n\n-- System logs for tracking application events\nCREATE TABLE IF NOT EXISTS system_logs (\n  id TEXT PRIMARY KEY,\n  level TEXT NOT NULL CHECK (level IN ('debug', 'info', 'warn', 'error', 'fatal')),\n  category TEXT NOT NULL CHECK (category IN ('auth', 'api', 'workflow', 'plugin', 'media', 'system', 'security', 'error')),\n  message TEXT NOT NULL,\n  data TEXT, -- JSON data\n  user_id TEXT REFERENCES users(id),\n  session_id TEXT,\n  request_id TEXT,\n  ip_address TEXT,\n  user_agent TEXT,\n  method TEXT,\n  url TEXT,\n  status_code INTEGER,\n  duration INTEGER,\n  stack_trace TEXT,\n  tags TEXT, -- JSON array\n  source TEXT,\n  created_at INTEGER NOT NULL DEFAULT (unixepoch())\n);\n\n-- Log configuration per category\nCREATE TABLE IF NOT EXISTS log_config (\n  id TEXT PRIMARY KEY,\n  category TEXT NOT NULL UNIQUE CHECK (category IN ('auth', 'api', 'workflow', 'plugin', 'media', 'system', 'security', 'error')),\n  enabled BOOLEAN NOT NULL DEFAULT TRUE,\n  level TEXT NOT NULL DEFAULT 'info' CHECK (level IN ('debug', 'info', 'warn', 'error', 'fatal')),\n  retention_days INTEGER NOT NULL DEFAULT 30,\n  max_size_mb INTEGER NOT NULL DEFAULT 100,\n  created_at INTEGER NOT NULL DEFAULT (unixepoch()),\n  updated_at INTEGER NOT NULL DEFAULT (unixepoch())\n);\n\n-- =============================================================================\n-- SECTION 8: SETTINGS\n-- =============================================================================\n\n-- Application settings\nCREATE TABLE IF NOT EXISTS settings (\n  id TEXT PRIMARY KEY,\n  category TEXT NOT NULL,\n  key TEXT NOT NULL,\n  value TEXT NOT NULL, -- JSON value\n  created_at INTEGER NOT NULL,\n  updated_at INTEGER NOT NULL,\n  UNIQUE(category, key)\n);\n\n-- =============================================================================\n-- SECTION 9: AUTHENTICATION EXTENSIONS (Magic Links, OTP)\n-- =============================================================================\n\n-- Magic links for passwordless login\nCREATE TABLE IF NOT EXISTS magic_links (\n  id TEXT PRIMARY KEY,\n  user_email TEXT NOT NULL,\n  token TEXT NOT NULL UNIQUE,\n  expires_at INTEGER NOT NULL,\n  used INTEGER DEFAULT 0,\n  used_at INTEGER,\n  ip_address TEXT,\n  user_agent TEXT,\n  created_at INTEGER NOT NULL\n);\n\n-- OTP codes for passwordless authentication\nCREATE TABLE IF NOT EXISTS otp_codes (\n  id TEXT PRIMARY KEY,\n  user_email TEXT NOT NULL,\n  code TEXT NOT NULL,\n  expires_at INTEGER NOT NULL,\n  used INTEGER DEFAULT 0,\n  used_at INTEGER,\n  ip_address TEXT,\n  user_agent TEXT,\n  attempts INTEGER DEFAULT 0,\n  created_at INTEGER NOT NULL\n);\n\n-- =============================================================================\n-- SECTION 10: FORMS SYSTEM\n-- =============================================================================\n\n-- Form definitions with Form.io integration and Turnstile support\nCREATE TABLE IF NOT EXISTS forms (\n  id TEXT PRIMARY KEY,\n  name TEXT NOT NULL UNIQUE,\n  display_name TEXT NOT NULL,\n  description TEXT,\n  category TEXT DEFAULT 'general',\n  formio_schema TEXT NOT NULL, -- Complete Form.io JSON schema\n  settings TEXT, -- JSON settings\n  is_active INTEGER DEFAULT 1,\n  is_public INTEGER DEFAULT 1,\n  managed INTEGER DEFAULT 0,\n  icon TEXT,\n  color TEXT,\n  tags TEXT, -- JSON array of tags\n  submission_count INTEGER DEFAULT 0,\n  view_count INTEGER DEFAULT 0,\n  created_by TEXT REFERENCES users(id),\n  updated_by TEXT REFERENCES users(id),\n  turnstile_enabled INTEGER DEFAULT 0,\n  turnstile_settings TEXT,\n  created_at INTEGER NOT NULL,\n  updated_at INTEGER NOT NULL\n);\n\n-- Form submissions\nCREATE TABLE IF NOT EXISTS form_submissions (\n  id TEXT PRIMARY KEY,\n  form_id TEXT NOT NULL REFERENCES forms(id) ON DELETE CASCADE,\n  submission_data TEXT NOT NULL, -- JSON\n  status TEXT DEFAULT 'pending',\n  submission_number INTEGER,\n  user_id TEXT REFERENCES users(id),\n  user_email TEXT,\n  ip_address TEXT,\n  user_agent TEXT,\n  referrer TEXT,\n  utm_source TEXT,\n  utm_medium TEXT,\n  utm_campaign TEXT,\n  reviewed_by TEXT REFERENCES users(id),\n  reviewed_at INTEGER,\n  review_notes TEXT,\n  is_spam INTEGER DEFAULT 0,\n  is_archived INTEGER DEFAULT 0,\n  submitted_at INTEGER NOT NULL,\n  updated_at INTEGER NOT NULL\n);\n\n-- Form file attachments\nCREATE TABLE IF NOT EXISTS form_files (\n  id TEXT PRIMARY KEY,\n  submission_id TEXT NOT NULL REFERENCES form_submissions(id) ON DELETE CASCADE,\n  media_id TEXT NOT NULL REFERENCES media(id) ON DELETE CASCADE,\n  field_name TEXT NOT NULL,\n  uploaded_at INTEGER NOT NULL\n);\n\n-- =============================================================================\n-- SECTION 11: AI SEARCH PLUGIN\n-- =============================================================================\n\n-- AI search settings\nCREATE TABLE IF NOT EXISTS ai_search_settings (\n  id INTEGER PRIMARY KEY AUTOINCREMENT,\n  enabled BOOLEAN DEFAULT 0,\n  ai_mode_enabled BOOLEAN DEFAULT 1,\n  selected_collections TEXT,\n  dismissed_collections TEXT,\n  autocomplete_enabled BOOLEAN DEFAULT 1,\n  cache_duration INTEGER DEFAULT 1,\n  results_limit INTEGER DEFAULT 20,\n  index_media BOOLEAN DEFAULT 0,\n  index_status TEXT,\n  last_indexed_at INTEGER,\n  created_at INTEGER DEFAULT (strftime('%s', 'now') * 1000),\n  updated_at INTEGER DEFAULT (strftime('%s', 'now') * 1000)\n);\n\n-- AI search history/analytics\nCREATE TABLE IF NOT EXISTS ai_search_history (\n  id INTEGER PRIMARY KEY AUTOINCREMENT,\n  query TEXT NOT NULL,\n  mode TEXT,\n  results_count INTEGER,\n  user_id INTEGER,\n  created_at INTEGER DEFAULT (strftime('%s', 'now') * 1000)\n);\n\n-- AI search index metadata per collection\nCREATE TABLE IF NOT EXISTS ai_search_index_meta (\n  id INTEGER PRIMARY KEY AUTOINCREMENT,\n  collection_id INTEGER NOT NULL,\n  collection_name TEXT NOT NULL,\n  total_items INTEGER DEFAULT 0,\n  indexed_items INTEGER DEFAULT 0,\n  last_sync_at INTEGER,\n  status TEXT DEFAULT 'pending',\n  error_message TEXT,\n  UNIQUE(collection_id)\n);\n\n-- =============================================================================\n-- SECTION 12: INDEXES\n-- =============================================================================\n\n-- Users indexes\nCREATE INDEX IF NOT EXISTS idx_users_email ON users(email);\nCREATE INDEX IF NOT EXISTS idx_users_username ON users(username);\nCREATE INDEX IF NOT EXISTS idx_users_role ON users(role);\nCREATE INDEX IF NOT EXISTS idx_users_email_verification_token ON users(email_verification_token);\nCREATE INDEX IF NOT EXISTS idx_users_password_reset_token ON users(password_reset_token);\nCREATE INDEX IF NOT EXISTS idx_users_invitation_token ON users(invitation_token);\n\n-- Collections indexes\nCREATE INDEX IF NOT EXISTS idx_collections_name ON collections(name);\nCREATE INDEX IF NOT EXISTS idx_collections_active ON collections(is_active);\nCREATE INDEX IF NOT EXISTS idx_collections_managed ON collections(managed);\nCREATE INDEX IF NOT EXISTS idx_collections_managed_active ON collections(managed, is_active);\n\n-- Content indexes\nCREATE INDEX IF NOT EXISTS idx_content_collection ON content(collection_id);\nCREATE INDEX IF NOT EXISTS idx_content_author ON content(author_id);\nCREATE INDEX IF NOT EXISTS idx_content_status ON content(status);\nCREATE INDEX IF NOT EXISTS idx_content_published ON content(published_at);\nCREATE INDEX IF NOT EXISTS idx_content_slug ON content(slug);\nCREATE INDEX IF NOT EXISTS idx_content_scheduled_publish ON content(scheduled_publish_at);\nCREATE INDEX IF NOT EXISTS idx_content_scheduled_unpublish ON content(scheduled_unpublish_at);\nCREATE INDEX IF NOT EXISTS idx_content_review_status ON content(review_status);\nCREATE INDEX IF NOT EXISTS idx_content_reviewer ON content(reviewer_id);\nCREATE INDEX IF NOT EXISTS idx_content_content_type ON content(content_type);\nCREATE INDEX IF NOT EXISTS idx_content_workflow_state ON content(workflow_state_id);\n\n-- Content versions indexes\nCREATE INDEX IF NOT EXISTS idx_content_versions_content ON content_versions(content_id);\nCREATE INDEX IF NOT EXISTS idx_content_versions_version ON content_versions(version);\nCREATE INDEX IF NOT EXISTS idx_content_versions_content_id ON content_versions(content_id);\n\n-- Media indexes\nCREATE INDEX IF NOT EXISTS idx_media_folder ON media(folder);\nCREATE INDEX IF NOT EXISTS idx_media_type ON media(mime_type);\nCREATE INDEX IF NOT EXISTS idx_media_uploaded_by ON media(uploaded_by);\nCREATE INDEX IF NOT EXISTS idx_media_uploaded_at ON media(uploaded_at);\nCREATE INDEX IF NOT EXISTS idx_media_deleted ON media(deleted_at);\n\n-- API tokens indexes\nCREATE INDEX IF NOT EXISTS idx_api_tokens_user ON api_tokens(user_id);\nCREATE INDEX IF NOT EXISTS idx_api_tokens_token ON api_tokens(token);\n\n-- Workflow history indexes\nCREATE INDEX IF NOT EXISTS idx_workflow_history_content ON workflow_history(content_id);\nCREATE INDEX IF NOT EXISTS idx_workflow_history_user ON workflow_history(user_id);\nCREATE INDEX IF NOT EXISTS idx_workflow_history_content_id ON workflow_history(content_id);\n\n-- Content fields indexes\nCREATE INDEX IF NOT EXISTS idx_content_fields_collection ON content_fields(collection_id);\nCREATE INDEX IF NOT EXISTS idx_content_fields_name ON content_fields(field_name);\nCREATE INDEX IF NOT EXISTS idx_content_fields_type ON content_fields(field_type);\nCREATE INDEX IF NOT EXISTS idx_content_fields_order ON content_fields(field_order);\n\n-- Content relationships indexes\nCREATE INDEX IF NOT EXISTS idx_content_relationships_source ON content_relationships(source_content_id);\nCREATE INDEX IF NOT EXISTS idx_content_relationships_target ON content_relationships(target_content_id);\nCREATE INDEX IF NOT EXISTS idx_content_relationships_type ON content_relationships(relationship_type);\n\n-- Workflow templates indexes\nCREATE INDEX IF NOT EXISTS idx_workflow_templates_collection ON workflow_templates(collection_id);\nCREATE INDEX IF NOT EXISTS idx_workflow_templates_active ON workflow_templates(is_active);\n\n-- Team & membership indexes\nCREATE INDEX IF NOT EXISTS idx_team_memberships_team_id ON team_memberships(team_id);\nCREATE INDEX IF NOT EXISTS idx_team_memberships_user_id ON team_memberships(user_id);\n\n-- User sessions indexes\nCREATE INDEX IF NOT EXISTS idx_user_sessions_user_id ON user_sessions(user_id);\nCREATE INDEX IF NOT EXISTS idx_user_sessions_token_hash ON user_sessions(token_hash);\n\n-- Activity logs indexes\nCREATE INDEX IF NOT EXISTS idx_activity_logs_user_id ON activity_logs(user_id);\nCREATE INDEX IF NOT EXISTS idx_activity_logs_created_at ON activity_logs(created_at);\nCREATE INDEX IF NOT EXISTS idx_activity_logs_resource ON activity_logs(resource_type, resource_id);\n\n-- Password history indexes\nCREATE INDEX IF NOT EXISTS idx_password_history_user_id ON password_history(user_id);\n\n-- Workflow system indexes\nCREATE INDEX IF NOT EXISTS idx_content_workflow_status_content_id ON content_workflow_status(content_id);\nCREATE INDEX IF NOT EXISTS idx_content_workflow_status_workflow_id ON content_workflow_status(workflow_id);\nCREATE INDEX IF NOT EXISTS idx_scheduled_content_scheduled_at ON scheduled_content(scheduled_at);\nCREATE INDEX IF NOT EXISTS idx_scheduled_content_status ON scheduled_content(status);\nCREATE INDEX IF NOT EXISTS idx_notifications_user_id ON notifications(user_id);\nCREATE INDEX IF NOT EXISTS idx_notifications_is_read ON notifications(is_read);\nCREATE INDEX IF NOT EXISTS idx_auto_save_drafts_user_id ON auto_save_drafts(user_id);\n\n-- Plugin system indexes\nCREATE INDEX IF NOT EXISTS idx_plugins_status ON plugins(status);\nCREATE INDEX IF NOT EXISTS idx_plugins_category ON plugins(category);\nCREATE INDEX IF NOT EXISTS idx_plugin_hooks_plugin ON plugin_hooks(plugin_id);\nCREATE INDEX IF NOT EXISTS idx_plugin_routes_plugin ON plugin_routes(plugin_id);\nCREATE INDEX IF NOT EXISTS idx_plugin_assets_plugin ON plugin_assets(plugin_id);\nCREATE INDEX IF NOT EXISTS idx_plugin_activity_plugin ON plugin_activity_log(plugin_id);\nCREATE INDEX IF NOT EXISTS idx_plugin_activity_timestamp ON plugin_activity_log(timestamp);\n\n-- FAQ indexes\nCREATE INDEX IF NOT EXISTS idx_faqs_category ON faqs(category);\nCREATE INDEX IF NOT EXISTS idx_faqs_published ON faqs(isPublished);\nCREATE INDEX IF NOT EXISTS idx_faqs_sort_order ON faqs(sortOrder);\n\n-- Testimonials indexes\nCREATE INDEX IF NOT EXISTS idx_testimonials_published ON testimonials(isPublished);\nCREATE INDEX IF NOT EXISTS idx_testimonials_sort_order ON testimonials(sortOrder);\nCREATE INDEX IF NOT EXISTS idx_testimonials_rating ON testimonials(rating);\n\n-- Code examples indexes\nCREATE INDEX IF NOT EXISTS idx_code_examples_published ON code_examples(isPublished);\nCREATE INDEX IF NOT EXISTS idx_code_examples_sort_order ON code_examples(sortOrder);\nCREATE INDEX IF NOT EXISTS idx_code_examples_language ON code_examples(language);\nCREATE INDEX IF NOT EXISTS idx_code_examples_category ON code_examples(category);\n\n-- System logging indexes\nCREATE INDEX IF NOT EXISTS idx_system_logs_level ON system_logs(level);\nCREATE INDEX IF NOT EXISTS idx_system_logs_category ON system_logs(category);\nCREATE INDEX IF NOT EXISTS idx_system_logs_created_at ON system_logs(created_at);\nCREATE INDEX IF NOT EXISTS idx_system_logs_user_id ON system_logs(user_id);\nCREATE INDEX IF NOT EXISTS idx_system_logs_status_code ON system_logs(status_code);\nCREATE INDEX IF NOT EXISTS idx_system_logs_source ON system_logs(source);\n\n-- Settings indexes\nCREATE INDEX IF NOT EXISTS idx_settings_category ON settings(category);\nCREATE INDEX IF NOT EXISTS idx_settings_category_key ON settings(category, key);\n\n-- Magic links indexes\nCREATE INDEX IF NOT EXISTS idx_magic_links_token ON magic_links(token);\nCREATE INDEX IF NOT EXISTS idx_magic_links_email ON magic_links(user_email);\nCREATE INDEX IF NOT EXISTS idx_magic_links_expires ON magic_links(expires_at);\n\n-- OTP codes indexes\nCREATE INDEX IF NOT EXISTS idx_otp_email_code ON otp_codes(user_email, code);\nCREATE INDEX IF NOT EXISTS idx_otp_expires ON otp_codes(expires_at);\nCREATE INDEX IF NOT EXISTS idx_otp_used ON otp_codes(used);\n\n-- Forms indexes\nCREATE INDEX IF NOT EXISTS idx_forms_name ON forms(name);\nCREATE INDEX IF NOT EXISTS idx_forms_category ON forms(category);\nCREATE INDEX IF NOT EXISTS idx_forms_active ON forms(is_active);\nCREATE INDEX IF NOT EXISTS idx_forms_public ON forms(is_public);\nCREATE INDEX IF NOT EXISTS idx_forms_created_by ON forms(created_by);\nCREATE INDEX IF NOT EXISTS idx_forms_turnstile ON forms(turnstile_enabled);\n\n-- Form submissions indexes\nCREATE INDEX IF NOT EXISTS idx_form_submissions_form_id ON form_submissions(form_id);\nCREATE INDEX IF NOT EXISTS idx_form_submissions_status ON form_submissions(status);\nCREATE INDEX IF NOT EXISTS idx_form_submissions_user_id ON form_submissions(user_id);\nCREATE INDEX IF NOT EXISTS idx_form_submissions_email ON form_submissions(user_email);\nCREATE INDEX IF NOT EXISTS idx_form_submissions_submitted_at ON form_submissions(submitted_at);\nCREATE INDEX IF NOT EXISTS idx_form_submissions_spam ON form_submissions(is_spam);\n\n-- Form files indexes\nCREATE INDEX IF NOT EXISTS idx_form_files_submission ON form_files(submission_id);\nCREATE INDEX IF NOT EXISTS idx_form_files_media ON form_files(media_id);\n\n-- AI search indexes\nCREATE INDEX IF NOT EXISTS idx_ai_search_history_created_at ON ai_search_history(created_at);\nCREATE INDEX IF NOT EXISTS idx_ai_search_history_mode ON ai_search_history(mode);\nCREATE INDEX IF NOT EXISTS idx_ai_search_index_meta_collection_id ON ai_search_index_meta(collection_id);\nCREATE INDEX IF NOT EXISTS idx_ai_search_index_meta_status ON ai_search_index_meta(status);\n\n-- =============================================================================\n-- SECTION 13: TRIGGERS\n-- =============================================================================\n\n-- Auto-update updated_at for FAQs\nCREATE TRIGGER IF NOT EXISTS faqs_updated_at\n  AFTER UPDATE ON faqs\nBEGIN\n  UPDATE faqs SET updated_at = strftime('%s', 'now') WHERE id = NEW.id;\nEND;\n\n-- Auto-update updated_at for testimonials\nCREATE TRIGGER IF NOT EXISTS testimonials_updated_at\n  AFTER UPDATE ON testimonials\nBEGIN\n  UPDATE testimonials SET updated_at = strftime('%s', 'now') WHERE id = NEW.id;\nEND;\n\n-- Auto-update updated_at for code examples\nCREATE TRIGGER IF NOT EXISTS code_examples_updated_at\n  AFTER UPDATE ON code_examples\nBEGIN\n  UPDATE code_examples SET updated_at = strftime('%s', 'now') WHERE id = NEW.id;\nEND;\n\n-- Auto-increment submission_number per form\nCREATE TRIGGER IF NOT EXISTS set_submission_number\nAFTER INSERT ON form_submissions\nBEGIN\n  UPDATE form_submissions\n  SET submission_number = (\n    SELECT COUNT(*)\n    FROM form_submissions\n    WHERE form_id = NEW.form_id\n    AND id <= NEW.id\n  )\n  WHERE id = NEW.id;\nEND;\n\n-- Auto-increment form submission_count\nCREATE TRIGGER IF NOT EXISTS increment_form_submission_count\nAFTER INSERT ON form_submissions\nBEGIN\n  UPDATE forms\n  SET submission_count = submission_count + 1,\n      updated_at = unixepoch() * 1000\n  WHERE id = NEW.form_id;\nEND;\n\n-- =============================================================================\n-- SECTION 14: SEED DATA\n-- =============================================================================\n\n-- ---------------------------------------------------------------------------\n-- 14a: Collections (pages + news only, slug type fixed per migration 028)\n-- ---------------------------------------------------------------------------\n\nINSERT OR IGNORE INTO collections (\n  id, name, display_name, description, schema,\n  is_active, managed, created_at, updated_at\n) VALUES (\n  'pages-collection',\n  'pages',\n  'Pages',\n  'Static page content collection',\n  '{\"type\":\"object\",\"properties\":{\"title\":{\"type\":\"string\",\"title\":\"Title\",\"required\":true},\"content\":{\"type\":\"string\",\"title\":\"Content\",\"format\":\"richtext\"},\"slug\":{\"type\":\"slug\",\"title\":\"Slug\"},\"meta_description\":{\"type\":\"string\",\"title\":\"Meta Description\"},\"featured_image\":{\"type\":\"string\",\"title\":\"Featured Image\",\"format\":\"media\"}},\"required\":[\"title\"]}',\n  1,\n  0,\n  strftime('%s', 'now') * 1000,\n  strftime('%s', 'now') * 1000\n),\n(\n  'news-collection',\n  'news',\n  'News',\n  'News article content collection',\n  '{\"type\":\"object\",\"properties\":{\"title\":{\"type\":\"string\",\"title\":\"Title\",\"required\":true},\"content\":{\"type\":\"string\",\"title\":\"Content\",\"format\":\"richtext\"},\"publish_date\":{\"type\":\"string\",\"title\":\"Publish Date\",\"format\":\"date\"},\"author\":{\"type\":\"string\",\"title\":\"Author\"},\"category\":{\"type\":\"string\",\"title\":\"Category\",\"enum\":[\"technology\",\"business\",\"general\"]}},\"required\":[\"title\"]}',\n  1,\n  0,\n  strftime('%s', 'now') * 1000,\n  strftime('%s', 'now') * 1000\n);\n\n-- ---------------------------------------------------------------------------\n-- 14b: Workflow states (6 defaults)\n-- ---------------------------------------------------------------------------\n\nINSERT OR IGNORE INTO workflow_states (id, name, description, color, is_initial, is_final) VALUES\n  ('draft', 'Draft', 'Content is being worked on', '#F59E0B', 1, 0),\n  ('pending-review', 'Pending Review', 'Content is waiting for review', '#3B82F6', 0, 0),\n  ('approved', 'Approved', 'Content has been approved', '#10B981', 0, 0),\n  ('published', 'Published', 'Content is live', '#059669', 0, 1),\n  ('rejected', 'Rejected', 'Content was rejected', '#EF4444', 0, 1),\n  ('archived', 'Archived', 'Content has been archived', '#6B7280', 0, 1);\n\n-- ---------------------------------------------------------------------------\n-- 14c: Default workflow template\n-- ---------------------------------------------------------------------------\n\nINSERT OR IGNORE INTO workflow_templates (\n  id, name, description, workflow_steps, is_active, created_at, updated_at\n) VALUES (\n  'default-content-workflow',\n  'Default Content Workflow',\n  'Standard content workflow: Draft -> Review -> Published',\n  '[\n    {\"step\": \"draft\", \"name\": \"Draft\", \"description\": \"Content is being created\", \"permissions\": [\"author\", \"editor\", \"admin\"]},\n    {\"step\": \"review\", \"name\": \"Under Review\", \"description\": \"Content is pending review\", \"permissions\": [\"editor\", \"admin\"]},\n    {\"step\": \"published\", \"name\": \"Published\", \"description\": \"Content is live\", \"permissions\": [\"editor\", \"admin\"]},\n    {\"step\": \"archived\", \"name\": \"Archived\", \"description\": \"Content is archived\", \"permissions\": [\"admin\"]}\n  ]',\n  1,\n  strftime('%s', 'now') * 1000,\n  strftime('%s', 'now') * 1000\n);\n\n-- ---------------------------------------------------------------------------\n-- 14d: Permissions (22 default + manage:plugins)\n-- ---------------------------------------------------------------------------\n\nINSERT OR IGNORE INTO permissions (id, name, description, category, created_at) VALUES\n  ('perm_content_create', 'content.create', 'Create new content', 'content', strftime('%s', 'now') * 1000),\n  ('perm_content_read', 'content.read', 'View content', 'content', strftime('%s', 'now') * 1000),\n  ('perm_content_update', 'content.update', 'Edit existing content', 'content', strftime('%s', 'now') * 1000),\n  ('perm_content_delete', 'content.delete', 'Delete content', 'content', strftime('%s', 'now') * 1000),\n  ('perm_content_publish', 'content.publish', 'Publish/unpublish content', 'content', strftime('%s', 'now') * 1000),\n  ('perm_collections_create', 'collections.create', 'Create new collections', 'collections', strftime('%s', 'now') * 1000),\n  ('perm_collections_read', 'collections.read', 'View collections', 'collections', strftime('%s', 'now') * 1000),\n  ('perm_collections_update', 'collections.update', 'Edit collections', 'collections', strftime('%s', 'now') * 1000),\n  ('perm_collections_delete', 'collections.delete', 'Delete collections', 'collections', strftime('%s', 'now') * 1000),\n  ('perm_collections_fields', 'collections.fields', 'Manage collection fields', 'collections', strftime('%s', 'now') * 1000),\n  ('perm_media_upload', 'media.upload', 'Upload media files', 'media', strftime('%s', 'now') * 1000),\n  ('perm_media_read', 'media.read', 'View media files', 'media', strftime('%s', 'now') * 1000),\n  ('perm_media_update', 'media.update', 'Edit media metadata', 'media', strftime('%s', 'now') * 1000),\n  ('perm_media_delete', 'media.delete', 'Delete media files', 'media', strftime('%s', 'now') * 1000),\n  ('perm_users_create', 'users.create', 'Invite new users', 'users', strftime('%s', 'now') * 1000),\n  ('perm_users_read', 'users.read', 'View user profiles', 'users', strftime('%s', 'now') * 1000),\n  ('perm_users_update', 'users.update', 'Edit user profiles', 'users', strftime('%s', 'now') * 1000),\n  ('perm_users_delete', 'users.delete', 'Deactivate users', 'users', strftime('%s', 'now') * 1000),\n  ('perm_users_roles', 'users.roles', 'Manage user roles', 'users', strftime('%s', 'now') * 1000),\n  ('perm_settings_read', 'settings.read', 'View system settings', 'settings', strftime('%s', 'now') * 1000),\n  ('perm_settings_update', 'settings.update', 'Modify system settings', 'settings', strftime('%s', 'now') * 1000),\n  ('perm_activity_read', 'activity.read', 'View activity logs', 'settings', strftime('%s', 'now') * 1000),\n  -- Plugin management permission (migration 006)\n  ('manage:plugins', 'Manage Plugins', 'Install, uninstall, activate, and configure plugins', 'system', unixepoch());\n\n-- ---------------------------------------------------------------------------\n-- 14e: Role permissions (admin=21, editor=9, viewer=4 + manage:plugins for admin)\n-- ---------------------------------------------------------------------------\n\nINSERT OR IGNORE INTO role_permissions (id, role, permission_id, created_at) VALUES\n  -- Admin: all 21 base permissions\n  ('rp_admin_content_create', 'admin', 'perm_content_create', strftime('%s', 'now') * 1000),\n  ('rp_admin_content_read', 'admin', 'perm_content_read', strftime('%s', 'now') * 1000),\n  ('rp_admin_content_update', 'admin', 'perm_content_update', strftime('%s', 'now') * 1000),\n  ('rp_admin_content_delete', 'admin', 'perm_content_delete', strftime('%s', 'now') * 1000),\n  ('rp_admin_content_publish', 'admin', 'perm_content_publish', strftime('%s', 'now') * 1000),\n  ('rp_admin_collections_create', 'admin', 'perm_collections_create', strftime('%s', 'now') * 1000),\n  ('rp_admin_collections_read', 'admin', 'perm_collections_read', strftime('%s', 'now') * 1000),\n  ('rp_admin_collections_update', 'admin', 'perm_collections_update', strftime('%s', 'now') * 1000),\n  ('rp_admin_collections_delete', 'admin', 'perm_collections_delete', strftime('%s', 'now') * 1000),\n  ('rp_admin_collections_fields', 'admin', 'perm_collections_fields', strftime('%s', 'now') * 1000),\n  ('rp_admin_media_upload', 'admin', 'perm_media_upload', strftime('%s', 'now') * 1000),\n  ('rp_admin_media_read', 'admin', 'perm_media_read', strftime('%s', 'now') * 1000),\n  ('rp_admin_media_update', 'admin', 'perm_media_update', strftime('%s', 'now') * 1000),\n  ('rp_admin_media_delete', 'admin', 'perm_media_delete', strftime('%s', 'now') * 1000),\n  ('rp_admin_users_create', 'admin', 'perm_users_create', strftime('%s', 'now') * 1000),\n  ('rp_admin_users_read', 'admin', 'perm_users_read', strftime('%s', 'now') * 1000),\n  ('rp_admin_users_update', 'admin', 'perm_users_update', strftime('%s', 'now') * 1000),\n  ('rp_admin_users_delete', 'admin', 'perm_users_delete', strftime('%s', 'now') * 1000),\n  ('rp_admin_users_roles', 'admin', 'perm_users_roles', strftime('%s', 'now') * 1000),\n  ('rp_admin_settings_read', 'admin', 'perm_settings_read', strftime('%s', 'now') * 1000),\n  ('rp_admin_settings_update', 'admin', 'perm_settings_update', strftime('%s', 'now') * 1000),\n  ('rp_admin_activity_read', 'admin', 'perm_activity_read', strftime('%s', 'now') * 1000),\n  -- Admin: manage plugins (migration 006)\n  ('role-perm-manage-plugins', 'admin', 'manage:plugins', unixepoch()),\n  -- Editor: 9 permissions\n  ('rp_editor_content_create', 'editor', 'perm_content_create', strftime('%s', 'now') * 1000),\n  ('rp_editor_content_read', 'editor', 'perm_content_read', strftime('%s', 'now') * 1000),\n  ('rp_editor_content_update', 'editor', 'perm_content_update', strftime('%s', 'now') * 1000),\n  ('rp_editor_content_publish', 'editor', 'perm_content_publish', strftime('%s', 'now') * 1000),\n  ('rp_editor_collections_read', 'editor', 'perm_collections_read', strftime('%s', 'now') * 1000),\n  ('rp_editor_media_upload', 'editor', 'perm_media_upload', strftime('%s', 'now') * 1000),\n  ('rp_editor_media_read', 'editor', 'perm_media_read', strftime('%s', 'now') * 1000),\n  ('rp_editor_media_update', 'editor', 'perm_media_update', strftime('%s', 'now') * 1000),\n  ('rp_editor_users_read', 'editor', 'perm_users_read', strftime('%s', 'now') * 1000),\n  -- Viewer: 4 permissions\n  ('rp_viewer_content_read', 'viewer', 'perm_content_read', strftime('%s', 'now') * 1000),\n  ('rp_viewer_collections_read', 'viewer', 'perm_collections_read', strftime('%s', 'now') * 1000),\n  ('rp_viewer_media_read', 'viewer', 'perm_media_read', strftime('%s', 'now') * 1000),\n  ('rp_viewer_users_read', 'viewer', 'perm_users_read', strftime('%s', 'now') * 1000);\n\n-- ---------------------------------------------------------------------------\n-- 14f: Log configuration (8 entries)\n-- ---------------------------------------------------------------------------\n\nINSERT OR IGNORE INTO log_config (id, category, enabled, level, retention_days, max_size_mb) VALUES\n  ('log-config-auth', 'auth', TRUE, 'info', 90, 50),\n  ('log-config-api', 'api', TRUE, 'info', 30, 100),\n  ('log-config-workflow', 'workflow', TRUE, 'info', 60, 50),\n  ('log-config-plugin', 'plugin', TRUE, 'warn', 30, 25),\n  ('log-config-media', 'media', TRUE, 'info', 30, 50),\n  ('log-config-system', 'system', TRUE, 'info', 90, 100),\n  ('log-config-security', 'security', TRUE, 'warn', 180, 100),\n  ('log-config-error', 'error', TRUE, 'error', 90, 200);\n\n-- ---------------------------------------------------------------------------\n-- 14g: Default settings (5 entries)\n-- ---------------------------------------------------------------------------\n\nINSERT OR IGNORE INTO settings (id, category, key, value, created_at, updated_at)\nVALUES\n  (lower(hex(randomblob(16))), 'general', 'siteName', '\"WarpCMS AI\"', unixepoch() * 1000, unixepoch() * 1000),\n  (lower(hex(randomblob(16))), 'general', 'siteDescription', '\"A modern headless CMS powered by AI\"', unixepoch() * 1000, unixepoch() * 1000),\n  (lower(hex(randomblob(16))), 'general', 'timezone', '\"UTC\"', unixepoch() * 1000, unixepoch() * 1000),\n  (lower(hex(randomblob(16))), 'general', 'language', '\"en\"', unixepoch() * 1000, unixepoch() * 1000),\n  (lower(hex(randomblob(16))), 'general', 'maintenanceMode', 'false', unixepoch() * 1000, unixepoch() * 1000);\n\n-- ---------------------------------------------------------------------------\n-- 14h: Default contact form\n-- ---------------------------------------------------------------------------\n\nINSERT OR IGNORE INTO forms (\n  id, name, display_name, description, category,\n  formio_schema, settings,\n  is_active, is_public,\n  turnstile_enabled, turnstile_settings,\n  created_at, updated_at\n) VALUES (\n  'default-contact-form',\n  'contact',\n  'Contact Form',\n  'A simple contact form for getting in touch',\n  'contact',\n  '{\"components\":[]}',\n  '{\"emailNotifications\":false,\"successMessage\":\"Thank you for your submission!\",\"submitButtonText\":\"Submit\",\"requireAuth\":false}',\n  1,\n  1,\n  0,\n  '{\"inherit\":true}',\n  unixepoch() * 1000,\n  unixepoch() * 1000\n);\n\n-- ---------------------------------------------------------------------------\n-- 14i: Plugin registrations (all 19 plugins, final state)\n-- ---------------------------------------------------------------------------\n\n-- 1. core-auth (active, core)\nINSERT OR IGNORE INTO plugins (\n  id, name, display_name, description, version, author, category, icon,\n  status, is_core, permissions, settings, installed_at, last_updated\n) VALUES (\n  'core-auth',\n  'core-auth',\n  'Authentication System',\n  'Core authentication and user management system',\n  '1.0.0',\n  'WarpCMS Team',\n  'security',\n  'üîê',\n  'active',\n  TRUE,\n  '[\"manage:users\", \"manage:roles\", \"manage:permissions\"]',\n  '{\"requiredFields\":{\"email\":{\"required\":1,\"minLength\":5,\"label\":\"Email\",\"type\":\"email\"},\"password\":{\"required\":1,\"minLength\":8,\"label\":\"Password\",\"type\":\"password\"},\"username\":{\"required\":1,\"minLength\":3,\"label\":\"Username\",\"type\":\"text\"},\"firstName\":{\"required\":1,\"minLength\":1,\"label\":\"First Name\",\"type\":\"text\"},\"lastName\":{\"required\":1,\"minLength\":1,\"label\":\"Last Name\",\"type\":\"text\"}},\"validation\":{\"emailFormat\":1,\"allowDuplicateUsernames\":0,\"passwordRequirements\":{\"requireUppercase\":0,\"requireLowercase\":0,\"requireNumbers\":0,\"requireSpecialChars\":0}},\"registration\":{\"enabled\":1,\"requireEmailVerification\":0,\"defaultRole\":\"viewer\"}}',\n  unixepoch(),\n  unixepoch()\n);\n\n-- 2. core-media (active, core)\nINSERT OR IGNORE INTO plugins (\n  id, name, display_name, description, version, author, category, icon,\n  status, is_core, permissions, installed_at, last_updated\n) VALUES (\n  'core-media',\n  'core-media',\n  'Media Manager',\n  'Core media upload and management system',\n  '1.0.0',\n  'WarpCMS Team',\n  'media',\n  'üì∏',\n  'active',\n  TRUE,\n  '[\"manage:media\", \"upload:files\"]',\n  unixepoch(),\n  unixepoch()\n);\n\n-- 3. core-workflow (active, core)\nINSERT OR IGNORE INTO plugins (\n  id, name, display_name, description, version, author, category, icon,\n  status, is_core, permissions, installed_at, last_updated\n) VALUES (\n  'core-workflow',\n  'core-workflow',\n  'Workflow Engine',\n  'Content workflow and approval system',\n  '1.0.0',\n  'WarpCMS Team',\n  'content',\n  'üîÑ',\n  'active',\n  TRUE,\n  '[\"manage:workflows\", \"approve:content\"]',\n  unixepoch(),\n  unixepoch()\n);\n\n-- 4. core-analytics (active, core)\nINSERT OR IGNORE INTO plugins (\n  id, name, display_name, description, version, author, category, icon,\n  status, is_core, permissions, installed_at, last_updated\n) VALUES (\n  'core-analytics',\n  'core-analytics',\n  'Analytics & Tracking',\n  'Core analytics tracking and reporting plugin with page views and event tracking',\n  '1.0.0',\n  'WarpCMS Team',\n  'seo',\n  'üìä',\n  'active',\n  TRUE,\n  '[\"view:analytics\", \"manage:tracking\"]',\n  unixepoch(),\n  unixepoch()\n);\n\n-- 5. demo-login-prefill (inactive, core) - original from 007\nINSERT OR IGNORE INTO plugins (\n  id, name, display_name, description, version, author, category, icon,\n  status, is_core, permissions, installed_at, last_updated\n) VALUES (\n  'demo-login-prefill',\n  'demo-login-plugin',\n  'Demo Login Prefill',\n  'Prefills login form with demo credentials (admin@warpcms.com/warpcms!) for easy site demonstration',\n  '1.0.0',\n  'WarpCMS',\n  'demo',\n  'üéØ',\n  'inactive',\n  TRUE,\n  '[]',\n  unixepoch(),\n  unixepoch()\n);\n\n-- 6. demo-login-plugin (active, non-core) - from 015\nINSERT OR IGNORE INTO plugins (\n  id, name, display_name, description, version, author, category, icon,\n  status, is_core, permissions, dependencies, installed_at, last_updated\n) VALUES (\n  'demo-login-plugin',\n  'demo-login-plugin',\n  'Demo Login Prefill',\n  'Prefills login form with demo credentials for easy site demonstration',\n  '1.0.0',\n  'WarpCMS',\n  'demo',\n  'üéØ',\n  'active',\n  FALSE,\n  '[]',\n  '[]',\n  unixepoch(),\n  unixepoch()\n);\n\n-- 7. faq-plugin (active, non-core)\nINSERT OR IGNORE INTO plugins (\n  id, name, display_name, description, version, author, category, icon,\n  status, is_core, permissions, installed_at, last_updated\n) VALUES (\n  'faq-plugin',\n  'faq-plugin',\n  'FAQ Management',\n  'Frequently Asked Questions management plugin with categories, search, and custom styling',\n  '1.0.0',\n  'WarpCMS',\n  'content',\n  '‚ùì',\n  'active',\n  FALSE,\n  '[\"manage:faqs\"]',\n  unixepoch(),\n  unixepoch()\n);\n\n-- 8. seed-data (inactive, non-core)\nINSERT OR IGNORE INTO plugins (\n  id, name, display_name, description, version, author, category, icon,\n  status, is_core, permissions, installed_at, last_updated\n) VALUES (\n  'seed-data',\n  'seed-data',\n  'Seed Data Generator',\n  'Generate realistic example users and content for testing and development',\n  '1.0.0',\n  'WarpCMS Team',\n  'development',\n  'üå±',\n  'inactive',\n  FALSE,\n  '[\"admin\"]',\n  unixepoch(),\n  unixepoch()\n);\n\n-- 9. database-tools (active, non-core)\nINSERT OR IGNORE INTO plugins (\n  id, name, display_name, description, version, author, category, icon,\n  status, is_core, permissions, installed_at, last_updated\n) VALUES (\n  'database-tools',\n  'database-tools',\n  'Database Tools',\n  'Database management tools including truncate, backup, and validation',\n  '1.0.0',\n  'WarpCMS Team',\n  'system',\n  'üóÑÔ∏è',\n  'active',\n  FALSE,\n  '[\"manage:database\", \"admin\"]',\n  unixepoch(),\n  unixepoch()\n);\n\n-- 10. testimonials-plugin (active, non-core)\nINSERT OR IGNORE INTO plugins (\n  id, name, display_name, description, version, author, category, icon,\n  status, is_core, permissions, dependencies, settings, installed_at, last_updated\n) VALUES (\n  'testimonials-plugin',\n  'testimonials-plugin',\n  'Customer Testimonials',\n  'Manage customer testimonials and reviews with rating support',\n  '1.0.0',\n  'WarpCMS',\n  'content',\n  '‚≠ê',\n  'active',\n  FALSE,\n  '[\"manage:testimonials\"]',\n  '[]',\n  '{\"defaultPublished\": true, \"requireRating\": false}',\n  unixepoch(),\n  unixepoch()\n);\n\n-- 11. code-examples-plugin (active, non-core)\nINSERT OR IGNORE INTO plugins (\n  id, name, display_name, description, version, author, category, icon,\n  status, is_core, permissions, dependencies, settings, installed_at, last_updated\n) VALUES (\n  'code-examples-plugin',\n  'code-examples-plugin',\n  'Code Examples',\n  'Manage code snippets and examples with syntax highlighting support',\n  '1.0.0',\n  'WarpCMS',\n  'content',\n  'üíª',\n  'active',\n  FALSE,\n  '[\"manage:code-examples\"]',\n  '[]',\n  '{\"defaultPublished\": true, \"supportedLanguages\": [\"javascript\", \"typescript\", \"python\", \"go\", \"rust\", \"java\", \"php\", \"ruby\", \"sql\"]}',\n  unixepoch(),\n  unixepoch()\n);\n\n-- 12. workflow-plugin (active, core)\nINSERT OR IGNORE INTO plugins (\n  id, name, display_name, description, version, author, category, icon,\n  status, is_core, permissions, dependencies, installed_at, last_updated\n) VALUES (\n  'workflow-plugin',\n  'workflow-plugin',\n  'Workflow Engine',\n  'Content workflow management with approval chains, scheduling, and automation',\n  '1.0.0',\n  'WarpCMS Team',\n  'content',\n  'üîÑ',\n  'active',\n  TRUE,\n  '[\"manage:workflows\", \"approve:content\"]',\n  '[]',\n  unixepoch(),\n  unixepoch()\n);\n\n-- 13. email (inactive, core)\nINSERT OR IGNORE INTO plugins (\n  id, name, display_name, description, version, author, category, icon,\n  status, is_core, permissions, installed_at, last_updated\n) VALUES (\n  'email',\n  'email',\n  'Email',\n  'Send transactional emails using Resend',\n  '1.0.0-beta.1',\n  'WarpCMS Team',\n  'utilities',\n  'üìß',\n  'inactive',\n  TRUE,\n  '[\"email:manage\", \"email:send\", \"email:view-logs\"]',\n  unixepoch(),\n  unixepoch()\n);\n\n-- 14. magic-link-auth (inactive, non-core, depends on email)\nINSERT OR IGNORE INTO plugins (\n  id, name, display_name, description, version, author, category, icon,\n  status, is_core, permissions, dependencies, installed_at, last_updated\n) VALUES (\n  'magic-link-auth',\n  'magic-link-auth',\n  'Magic Link Authentication',\n  'Passwordless authentication via email magic links. Users receive a secure one-time link to sign in without entering a password.',\n  '1.0.0',\n  'WarpCMS Team',\n  'security',\n  'üîó',\n  'inactive',\n  FALSE,\n  '[\"auth:manage\", \"auth:magic-link\"]',\n  '[\"email\"]',\n  unixepoch(),\n  unixepoch()\n);\n\n-- 15. tinymce-plugin (active, non-core)\nINSERT OR IGNORE INTO plugins (\n  id, name, display_name, description, version, author, category, icon,\n  status, is_core, permissions, dependencies, settings, installed_at, last_updated\n) VALUES (\n  'tinymce-plugin',\n  'tinymce-plugin',\n  'TinyMCE Rich Text Editor',\n  'Powerful WYSIWYG rich text editor for content creation. Provides a full-featured editor with formatting, media embedding, and customizable toolbars for richtext fields.',\n  '1.0.0',\n  'WarpCMS Team',\n  'editor',\n  '‚úèÔ∏è',\n  'active',\n  FALSE,\n  '[]',\n  '[]',\n  '{\"apiKey\":\"no-api-key\",\"defaultHeight\":300,\"defaultToolbar\":\"full\",\"skin\":\"oxide-dark\"}',\n  unixepoch(),\n  unixepoch()\n);\n\n-- 16. easy-mdx (active, non-core)\nINSERT OR IGNORE INTO plugins (\n  id, name, display_name, description, version, author, category, icon,\n  status, is_core, permissions, dependencies, settings, installed_at, last_updated\n) VALUES (\n  'easy-mdx',\n  'easy-mdx',\n  'EasyMDE Markdown Editor',\n  'Lightweight markdown editor with live preview. Provides a simple and efficient editor with markdown support for richtext fields.',\n  '1.0.0',\n  'WarpCMS Team',\n  'editor',\n  'üìù',\n  'active',\n  FALSE,\n  '[]',\n  '[]',\n  '{\"defaultHeight\":400,\"theme\":\"dark\",\"toolbar\":\"full\",\"placeholder\":\"Start writing your content...\"}',\n  unixepoch(),\n  unixepoch()\n);\n\n-- 17. quill-editor (active, non-core)\nINSERT OR IGNORE INTO plugins (\n  id, name, display_name, description, version, author, category, icon,\n  status, is_core, permissions, dependencies, settings, installed_at, last_updated\n) VALUES (\n  'quill-editor',\n  'quill-editor',\n  'Quill Rich Text Editor',\n  'Modern rich text editor for content creation. Provides a clean, intuitive WYSIWYG editor with customizable toolbars for richtext fields.',\n  '1.0.0',\n  'WarpCMS Team',\n  'editor',\n  '‚úçÔ∏è',\n  'active',\n  FALSE,\n  '[]',\n  '[]',\n  '{\"theme\":\"snow\",\"defaultHeight\":300,\"defaultToolbar\":\"full\",\"placeholder\":\"Start writing your content...\"}',\n  unixepoch(),\n  unixepoch()\n);\n\n-- 18. easymde-editor (inactive, core)\nINSERT OR IGNORE INTO plugins (\n  id, name, display_name, description, version, author, category, icon,\n  status, is_core, permissions, dependencies, settings, installed_at, last_updated\n) VALUES (\n  'easymde-editor',\n  'easymde-editor',\n  'EasyMDE Editor',\n  'Lightweight markdown editor for content creation. Simple, elegant WYSIWYG markdown editor with live preview, toolbar, and dark mode support for richtext fields.',\n  '1.0.0',\n  'WarpCMS Team',\n  'editor',\n  '‚úçÔ∏è',\n  'inactive',\n  TRUE,\n  '[]',\n  '[]',\n  '{\"theme\":\"dark\",\"defaultHeight\":300,\"toolbar\":\"full\",\"spellChecker\":false,\"placeholder\":\"Start writing your content...\"}',\n  unixepoch(),\n  unixepoch()\n);\n\n-- 19. otp-login (inactive, core)\nINSERT OR IGNORE INTO plugins (\n  id, name, display_name, description, version, author, category, icon,\n  status, is_core, permissions, installed_at, last_updated\n) VALUES (\n  'otp-login',\n  'otp-login',\n  'OTP Login',\n  'Passwordless authentication via email one-time codes',\n  '1.0.0-beta.1',\n  'WarpCMS Team',\n  'security',\n  'üî¢',\n  'inactive',\n  TRUE,\n  '[\"otp:manage\", \"otp:request\", \"otp:verify\"]',\n  unixepoch(),\n  unixepoch()\n);\n\n-- ---------------------------------------------------------------------------\n-- 14j: Content fields for pages and news (slug uses field_type='slug' per migration 027)\n-- ---------------------------------------------------------------------------\n\nINSERT OR IGNORE INTO content_fields (\n  id, collection_id, field_name, field_type, field_label, field_options, field_order, is_required, is_searchable, created_at, updated_at\n) VALUES\n-- Pages fields\n('pages-title-field', 'pages-collection', 'title', 'text', 'Title', '{\"maxLength\": 200, \"placeholder\": \"Enter page title\"}', 1, 1, 1, strftime('%s', 'now') * 1000, strftime('%s', 'now') * 1000),\n('pages-content-field', 'pages-collection', 'content', 'richtext', 'Content', '{\"toolbar\": \"full\", \"height\": 500}', 2, 1, 1, strftime('%s', 'now') * 1000, strftime('%s', 'now') * 1000),\n('pages-slug-field', 'pages-collection', 'slug', 'slug', 'URL Slug', '{\"pattern\": \"^[a-zA-Z0-9_-]+$\", \"placeholder\": \"url-friendly-slug\", \"help\": \"Use letters, numbers, underscores, and hyphens only\"}', 3, 1, 0, strftime('%s', 'now') * 1000, strftime('%s', 'now') * 1000),\n('pages-meta-desc-field', 'pages-collection', 'meta_description', 'text', 'Meta Description', '{\"maxLength\": 160, \"rows\": 2, \"placeholder\": \"SEO description for search engines\"}', 4, 0, 0, strftime('%s', 'now') * 1000, strftime('%s', 'now') * 1000),\n('pages-template-field', 'pages-collection', 'template', 'select', 'Page Template', '{\"options\": [\"default\", \"landing\", \"contact\", \"about\"], \"default\": \"default\"}', 5, 0, 0, strftime('%s', 'now') * 1000, strftime('%s', 'now') * 1000),\n\n-- News fields\n('news-title-field', 'news-collection', 'title', 'text', 'Title', '{\"maxLength\": 200, \"placeholder\": \"Enter news title\"}', 1, 1, 1, strftime('%s', 'now') * 1000, strftime('%s', 'now') * 1000),\n('news-content-field', 'news-collection', 'content', 'richtext', 'Content', '{\"toolbar\": \"news\", \"height\": 400}', 2, 1, 1, strftime('%s', 'now') * 1000, strftime('%s', 'now') * 1000),\n('news-category-field', 'news-collection', 'category', 'select', 'Category', '{\"options\": [\"technology\", \"business\", \"politics\", \"sports\", \"entertainment\", \"health\"], \"required\": true}', 3, 1, 1, strftime('%s', 'now') * 1000, strftime('%s', 'now') * 1000),\n('news-author-field', 'news-collection', 'author', 'text', 'Author', '{\"placeholder\": \"Author name\"}', 4, 1, 1, strftime('%s', 'now') * 1000, strftime('%s', 'now') * 1000),\n('news-source-field', 'news-collection', 'source', 'text', 'Source', '{\"placeholder\": \"News source\"}', 5, 0, 1, strftime('%s', 'now') * 1000, strftime('%s', 'now') * 1000),\n('news-priority-field', 'news-collection', 'priority', 'select', 'Priority', '{\"options\": [\"low\", \"normal\", \"high\", \"breaking\"], \"default\": \"normal\"}', 6, 0, 0, strftime('%s', 'now') * 1000, strftime('%s', 'now') * 1000);\n\n-- =============================================================================\n-- END OF CONSOLIDATED MIGRATION\n-- =============================================================================\n"
  },
  {
    id: '0002',
    name: 'Consolidate Content Types',
    filename: '0002_consolidate_content_types.sql',
    description: 'Migration 0002: Consolidate Content Types',
    sql: "-- Consolidate removed content types to their equivalents.\n-- pdf -> file (browsers handle PDF display natively; file type accepts any file)\n-- html -> text (HTML type was identical to text with a richtext editor)\n-- Idempotent: safe to run multiple times.\nUPDATE content SET collection_id = 'file' WHERE collection_id = 'pdf';\nUPDATE content SET collection_id = 'text' WHERE collection_id = 'html';\n"
  },
  {
    id: '0003',
    name: 'Drop Content Collections Fk',
    filename: '0003_drop_content_collections_fk.sql',
    description: 'Migration 0003: Drop Content Collections Fk',
    sql: "-- Remove FOREIGN KEY constraint on content.collection_id -> collections(id).\n-- The content-remodel replaced dynamic collections with hardcoded content types\n-- (image, text, file). collection_id now stores the type name directly.\n-- SQLite does not support ALTER TABLE DROP CONSTRAINT, so we recreate the table.\n\nPRAGMA foreign_keys = OFF;\n\n-- 1. Rename existing table\nALTER TABLE content RENAME TO content_old;\n\n-- 2. Create new table without the FK on collection_id\nCREATE TABLE content (\n  id TEXT PRIMARY KEY,\n  collection_id TEXT NOT NULL, -- content type name (image, text, file)\n  slug TEXT NOT NULL,\n  title TEXT NOT NULL,\n  data TEXT NOT NULL,\n  status TEXT NOT NULL DEFAULT 'draft',\n  published_at INTEGER,\n  author_id TEXT NOT NULL REFERENCES users(id),\n  created_at INTEGER NOT NULL,\n  updated_at INTEGER NOT NULL,\n  scheduled_publish_at INTEGER,\n  scheduled_unpublish_at INTEGER,\n  review_status TEXT DEFAULT 'none',\n  reviewer_id TEXT REFERENCES users(id),\n  reviewed_at INTEGER,\n  review_notes TEXT,\n  meta_title TEXT,\n  meta_description TEXT,\n  featured_image_id TEXT REFERENCES media(id),\n  content_type TEXT DEFAULT 'standard',\n  workflow_state_id TEXT DEFAULT 'draft',\n  embargo_until DATETIME,\n  expires_at DATETIME,\n  version_number INTEGER DEFAULT 1,\n  is_auto_saved INTEGER DEFAULT 0\n);\n\n-- 3. Copy data\nINSERT INTO content SELECT * FROM content_old;\n\n-- 4. Drop old table\nDROP TABLE content_old;\n\nPRAGMA foreign_keys = ON;\n"
  },
  {
    id: '0004',
    name: 'Remove Status And Published At',
    filename: '0004_remove_status_and_published_at.sql',
    description: 'Migration 0004: Remove Status And Published At',
    sql: "-- =============================================================================\n-- Migration 0004: Remove status, published_at from content; drop workflow_history\n-- =============================================================================\n-- Content no longer has a draft/published lifecycle. All content is visible.\n-- The workflow_history table only tracked status transitions, so it is removed.\n-- SQLite requires table recreation to drop columns.\n-- =============================================================================\n\n-- Step 1: Recreate content table without status and published_at\nCREATE TABLE IF NOT EXISTS content_new (\n  id TEXT PRIMARY KEY,\n  collection_id TEXT NOT NULL,\n  slug TEXT NOT NULL,\n  title TEXT NOT NULL,\n  data TEXT NOT NULL,\n  author_id TEXT NOT NULL REFERENCES users(id),\n  created_at INTEGER NOT NULL,\n  updated_at INTEGER NOT NULL,\n  scheduled_publish_at INTEGER,\n  scheduled_unpublish_at INTEGER,\n  review_status TEXT DEFAULT 'none',\n  reviewer_id TEXT REFERENCES users(id),\n  reviewed_at INTEGER,\n  review_notes TEXT,\n  meta_title TEXT,\n  meta_description TEXT,\n  featured_image_id TEXT REFERENCES media(id),\n  content_type TEXT DEFAULT 'standard',\n  workflow_state_id TEXT DEFAULT 'draft',\n  embargo_until DATETIME,\n  expires_at DATETIME,\n  version_number INTEGER DEFAULT 1,\n  is_auto_saved INTEGER DEFAULT 0\n);\n\n-- Step 2: Copy data from old table (excluding status and published_at)\nINSERT INTO content_new (\n  id, collection_id, slug, title, data, author_id, created_at, updated_at,\n  scheduled_publish_at, scheduled_unpublish_at, review_status, reviewer_id,\n  reviewed_at, review_notes, meta_title, meta_description, featured_image_id,\n  content_type, workflow_state_id, embargo_until, expires_at, version_number,\n  is_auto_saved\n)\nSELECT\n  id, collection_id, slug, title, data, author_id, created_at, updated_at,\n  scheduled_publish_at, scheduled_unpublish_at, review_status, reviewer_id,\n  reviewed_at, review_notes, meta_title, meta_description, featured_image_id,\n  content_type, workflow_state_id, embargo_until, expires_at, version_number,\n  is_auto_saved\nFROM content;\n\n-- Step 3: Drop old table and rename new one\nDROP TABLE content;\nALTER TABLE content_new RENAME TO content;\n\n-- Step 4: Drop workflow_history table\nDROP TABLE IF EXISTS workflow_history;\n"
  },
  {
    id: '0005',
    name: 'Add User Language',
    filename: '0005_add_user_language.sql',
    description: 'Migration 0005: Add User Language',
    sql: "-- Add language preference column to users table for i18n support.\n-- Accepted values: 'en', 'pt', 'es'. Defaults to 'en'.\n-- Note: The consolidated migration (0001) already includes this column,\n-- so this will be a no-op for databases created after consolidation.\n-- The migration service skips \"duplicate column name\" errors gracefully.\nALTER TABLE users ADD COLUMN language TEXT NOT NULL DEFAULT 'en';\n"
  }
]

// Map for quick lookup by ID
const migrationsByIdMap = new Map<string, BundledMigration>(
  bundledMigrations.map(m => [m.id, m])
)

// Get migration SQL by ID
export function getMigrationSQLById(id: string): string | null {
  return migrationsByIdMap.get(id)?.sql ?? null
}

// Get all migration info (without SQL for lighter payloads)
function getMigrationList(): Array<Omit<BundledMigration, 'sql'>> {
  return bundledMigrations.map(({ sql, ...rest }) => rest)
}
